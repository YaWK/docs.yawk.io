<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>YaWK: /var/www/htdocs/yawk.io/system/plugins/gallery/classes/SimpleImage.php</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<!-- ... other metadata & script includes ... -->
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript">
DoxygenAwesomeDarkModeToggle.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="new_stylesheet.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Abel&family=Roboto+Serif:wght@300&display=swap" rel="stylesheet">
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">YaWK
   &#160;<span id="projectnumber">23.4</span>
   </div>
   <div id="projectbrief">Yet another WebKit</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_2var_2www_2htdocs_2yawk_8io_2system_2plugins_2gallery_2classes_2SimpleImage_8php-example.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">/var/www/htdocs/yawk.io/system/plugins/gallery/classes/SimpleImage.php</div>  </div>
</div><!--header-->
<div class="contents">
<p>Creates a new image from a string.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$string</td><td>The raw image data as a string. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>SimpleImage</dd></dl>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">Exception::$string</td><td>= file_get_contents('image.jpg');</td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line">&lt;?php</div>
<div class="line"> </div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// SimpleImage</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  A PHP class that makes working with images as simple as possible.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Developed and maintained by Cory LaViska &lt;https://github.com/claviska&gt;.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Copyright A Beautiful Site, LLC.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Source: https://github.com/claviska/SimpleImage</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">//  Licensed under the MIT license &lt;http://opensource.org/licenses/MIT&gt;</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span><a class="code" href="namespaceYAWK.html">YAWK</a>;</div>
<div class="line"> </div>
<div class="line">use Exception;</div>
<div class="line">use League\ColorExtractor\Color;</div>
<div class="line">use League\ColorExtractor\ColorExtractor;</div>
<div class="line">use League\ColorExtractor\Palette;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * A PHP class that makes working with images as simple as possible.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">class </span>SimpleImage</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">const</span></div>
<div class="line">      ERR_FILE_NOT_FOUND = 1;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">const</span></div>
<div class="line">      ERR_FONT_FILE = 2;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">const</span></div>
<div class="line">      ERR_FREETYPE_NOT_ENABLED = 3;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">const</span></div>
<div class="line">      ERR_GD_NOT_ENABLED = 4;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">const</span></div>
<div class="line">      ERR_INVALID_COLOR = 5;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">const</span></div>
<div class="line">      ERR_INVALID_DATA_URI = 6;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">const</span></div>
<div class="line">      ERR_INVALID_IMAGE = 7;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">const</span></div>
<div class="line">      ERR_LIB_NOT_LOADED = 8;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">const</span></div>
<div class="line">      ERR_UNSUPPORTED_FORMAT = 9;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">const</span></div>
<div class="line">      ERR_WEBP_NOT_ENABLED = 10;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">const</span></div>
<div class="line">      ERR_WRITE = 11;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">const</span></div>
<div class="line">      ERR_INVALID_FLAG = 12;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">protected</span> array $flags;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">protected</span> $image;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">protected</span> <span class="keywordtype">string</span> $mimeType;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">protected</span> <span class="keyword">null</span>|array|<span class="keyword">false</span> $exif;</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    //////////////////////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment"></span>    <span class="comment">// Magic methods</span><span class="comment"></span></div>
<div class="line"><span class="comment">    //////////////////////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment"></span><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Creates a new SimpleImage object.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @param  string  $image An image file or a data URI to load.</span></div>
<div class="line"><span class="comment">     * @param  array  $flags Optional override of default flags.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @throws Exception Thrown if the GD library is not found; file|URI or image data is invalid.</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> __construct(<span class="keywordtype">string</span> $image = <span class="stringliteral">&#39;&#39;</span>, array $flags = [])</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Check for the required GD extension</span></div>
<div class="line">        <span class="keywordflow">if</span> (extension_loaded(<span class="stringliteral">&#39;gd&#39;</span>)) {</div>
<div class="line">            <span class="comment">// Ignore JPEG warnings that cause imagecreatefromjpeg() to fail</span></div>
<div class="line">            ini_set(<span class="stringliteral">&#39;gd.jpeg_ignore_warning&#39;</span>, <span class="charliteral">&#39;1&#39;</span>);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&#39;Required extension GD is not loaded.&#39;</span>, self::ERR_GD_NOT_ENABLED);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Associative array of flags.</span></div>
<div class="line">        $this-&gt;flags = [</div>
<div class="line">            <span class="stringliteral">&#39;sslVerify&#39;</span> =&gt; <span class="keyword">true</span>, <span class="comment">// Skip SSL peer validation</span></div>
<div class="line">        ];</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Override default flag values.</span></div>
<div class="line">        <span class="keywordflow">foreach</span> ($flags as $flag =&gt; <a name="a0"></a><a class="code" href="widget-edit_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a>) {</div>
<div class="line">            $this-&gt;setFlag($flag, <a class="code" href="widget-edit_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a>);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Load an image through the constructor</span></div>
<div class="line">        <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/^data:(.*?);/&#39;</span>, $image)) {</div>
<div class="line">            $this-&gt;fromDataUri($image);</div>
<div class="line">        } elseif ($image) {</div>
<div class="line">            $this-&gt;fromFile($image);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Destroys the image resource.</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> __destruct()</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">//Check for a valid GDimage instance</span></div>
<div class="line">        $type_check = (gettype($this-&gt;image) == <span class="stringliteral">&#39;object&#39;</span> &amp;&amp; $this-&gt;image::class == <span class="stringliteral">&#39;GdImage&#39;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (is_resource($this-&gt;image) &amp;&amp; $type_check) {</div>
<div class="line">            imagedestroy($this-&gt;image);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    //////////////////////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment"></span>    <span class="comment">// Helper functions</span><span class="comment"></span></div>
<div class="line"><span class="comment">    //////////////////////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment"></span><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Set flag value.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @param  string  $flag Name of the flag to set.</span></div>
<div class="line"><span class="comment">     * @param  bool  $value State of the flag.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @throws Exception Thrown if flag does not exist (no default value).</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> setFlag(<span class="keywordtype">string</span> $flag, <span class="keywordtype">bool</span> <a class="code" href="widget-edit_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a>): void</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Throw if flag does not exist</span></div>
<div class="line">        <span class="keywordflow">if</span> (! in_array($flag, array_keys($this-&gt;flags))) {</div>
<div class="line">            <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&#39;Invalid flag.&#39;</span>, self::ERR_INVALID_FLAG);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Set flag value by name</span></div>
<div class="line">        $this-&gt;flags[$flag] = <a class="code" href="widget-edit_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a>;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Get flag value.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @param  string  $flag Name of the flag to get.</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> getFlag(<span class="keywordtype">string</span> $flag): ?bool</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> in_array($flag, array_keys($this-&gt;flags)) ? $this-&gt;flags[$flag] : <span class="keyword">null</span>;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    //////////////////////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment"></span>    <span class="comment">// Loaders</span><span class="comment"></span></div>
<div class="line"><span class="comment">    //////////////////////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment"></span><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Loads an image from a data URI.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @param  string  $uri A data URI.</span></div>
<div class="line"><span class="comment">     * @return SimpleImage</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @throws Exception Thrown if URI or image data is invalid.</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> fromDataUri(<span class="keywordtype">string</span> $uri): static</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Basic formatting check</span></div>
<div class="line">        preg_match(<span class="stringliteral">&#39;/^data:(.*?);/&#39;</span>, $uri, $matches);</div>
<div class="line">        <span class="keywordflow">if</span> (! count($matches)) {</div>
<div class="line">            <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&#39;Invalid data URI.&#39;</span>, self::ERR_INVALID_DATA_URI);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Determine mime type</span></div>
<div class="line">        $this-&gt;mimeType = $matches[1];</div>
<div class="line">        <span class="keywordflow">if</span> (! preg_match(<span class="stringliteral">&#39;/^image\/(gif|jpeg|png)$/&#39;</span>, $this-&gt;mimeType)) {</div>
<div class="line">            <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(</div>
<div class="line">                <span class="stringliteral">&#39;Unsupported format: &#39;</span>.$this-&gt;mimeType,</div>
<div class="line">                self::ERR_UNSUPPORTED_FORMAT</div>
<div class="line">            );</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Get image data</span></div>
<div class="line">        $uri = base64_decode(strval(preg_replace(<span class="stringliteral">&#39;/^data:(.*?);base64,/&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $uri)));</div>
<div class="line">        $this-&gt;image = imagecreatefromstring($uri);</div>
<div class="line">        <span class="keywordflow">if</span> (! $this-&gt;image) {</div>
<div class="line">            <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&#39;Invalid image data.&#39;</span>, self::ERR_INVALID_IMAGE);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> $this;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Loads an image from a file.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @param  string  $file The image file to load.</span></div>
<div class="line"><span class="comment">     * @return SimpleImage</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @throws Exception Thrown if file or image data is invalid.</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> fromFile(<span class="keywordtype">string</span> $file): static</div>
<div class="line">    {</div>
<div class="line">    <span class="comment">// Set fopen options.</span></div>
<div class="line">        $sslVerify = $this-&gt;getFlag(<span class="stringliteral">&#39;sslVerify&#39;</span>); <span class="comment">// Don&#39;t perform peer validation when true</span></div>
<div class="line">        $opts = [</div>
<div class="line">            <span class="stringliteral">&#39;ssl&#39;</span> =&gt; [</div>
<div class="line">                <span class="stringliteral">&#39;verify_peer&#39;</span> =&gt; $sslVerify,</div>
<div class="line">                <span class="stringliteral">&#39;verify_peer_name&#39;</span> =&gt; $sslVerify,</div>
<div class="line">            ],</div>
<div class="line">        ];</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Check if the file exists and is readable.</span></div>
<div class="line">        $file = @file_get_contents($file, <span class="keyword">false</span>, stream_context_create($opts));</div>
<div class="line">        <span class="keywordflow">if</span> ($file === <span class="keyword">false</span>) {</div>
<div class="line">            <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;File not found: $file&quot;</span>, self::ERR_FILE_NOT_FOUND);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Create image object from string</span></div>
<div class="line">        $this-&gt;image = imagecreatefromstring($file);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Get image info</span></div>
<div class="line">        $info = @getimagesizefromstring($file);</div>
<div class="line">        <span class="keywordflow">if</span> ($info === <span class="keyword">false</span>) {</div>
<div class="line">            <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;Invalid image file: $file&quot;</span>, self::ERR_INVALID_IMAGE);</div>
<div class="line">        }</div>
<div class="line">        $this-&gt;mimeType = $info[<span class="stringliteral">&#39;mime&#39;</span>];</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (! $this-&gt;image) {</div>
<div class="line">            <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&#39;Unsupported format: &#39;</span>.$this-&gt;mimeType, self::ERR_UNSUPPORTED_FORMAT);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">switch</span>($this-&gt;mimeType) {</div>
<div class="line">            <span class="keywordflow">case</span> <span class="stringliteral">&#39;image/gif&#39;</span>:</div>
<div class="line">                <span class="comment">// Copy the gif over to a true color image to preserve its transparency. This is a</span></div>
<div class="line">                <span class="comment">// workaround to prevent imagepalettetotruecolor() from borking transparency.</span></div>
<div class="line">                $width = imagesx($this-&gt;image);</div>
<div class="line">                $height = imagesx($this-&gt;image);</div>
<div class="line"> </div>
<div class="line">                $gif = imagecreatetruecolor((<span class="keywordtype">int</span>) $width, (<span class="keywordtype">int</span>) $height);</div>
<div class="line">                $alpha = imagecolorallocatealpha($gif, 0, 0, 0, 127);</div>
<div class="line">                imagecolortransparent($gif, $alpha ?: <span class="keyword">null</span>);</div>
<div class="line">                imagefill($gif, 0, 0, $alpha);</div>
<div class="line"> </div>
<div class="line">                imagecopy($this-&gt;image, $gif, 0, 0, 0, 0, $width, $height);</div>
<div class="line">                imagedestroy($gif);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <span class="stringliteral">&#39;image/jpeg&#39;</span>:</div>
<div class="line">                <span class="comment">// Load exif data from JPEG images</span></div>
<div class="line">                <span class="keywordflow">if</span> (function_exists(<span class="stringliteral">&#39;exif_read_data&#39;</span>)) {</div>
<div class="line">                    $this-&gt;exif = @exif_read_data(<span class="stringliteral">&#39;data://image/jpeg;base64,&#39;</span>.base64_encode($file));</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Convert pallete images to true color images</span></div>
<div class="line">        imagepalettetotruecolor($this-&gt;image);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> $this;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Creates a new image.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @param  int  $width The width of the image.</span></div>
<div class="line"><span class="comment">     * @param  int  $height The height of the image.</span></div>
<div class="line"><span class="comment">     * @param  string|array  $color Optional fill color for the new image (default &#39;transparent&#39;).</span></div>
<div class="line"><span class="comment">     * @return SimpleImage</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @throws Exception</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> fromNew(<span class="keywordtype">int</span> $width, <span class="keywordtype">int</span> $height, <span class="keywordtype">string</span>|array $color = <span class="stringliteral">&#39;transparent&#39;</span>): static</div>
<div class="line">    {</div>
<div class="line">        $this-&gt;image = imagecreatetruecolor($width, $height);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Use PNG for dynamically created images because it&#39;s lossless and supports transparency</span></div>
<div class="line">        $this-&gt;mimeType = <span class="stringliteral">&#39;image/png&#39;</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Fill the image with color</span></div>
<div class="line">        $this-&gt;fill($color);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> $this;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Creates a new image from a string.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @param  string  $string The raw image data as a string.</span></div>
<div class="line"><span class="comment">     * @return SimpleImage</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @throws Exception</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @example</span></div>
<div class="line"><span class="comment">     *    $string = file_get_contents(&#39;image.jpg&#39;);</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> fromString(<span class="keywordtype">string</span> $string): SimpleImage|static</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> $this-&gt;fromFile(<span class="stringliteral">&#39;data://;base64,&#39;</span>.base64_encode($string));</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    //////////////////////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment"></span>    <span class="comment">// Savers</span><span class="comment"></span></div>
<div class="line"><span class="comment">    //////////////////////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment"></span><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Generates an image.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @param  string|null  $mimeType The image format to output as a mime type (defaults to the original mime type).</span></div>
<div class="line"><span class="comment">     * @param  array|int  $options Array or Image quality as a percentage (default 100).</span></div>
<div class="line"><span class="comment">     * @return array Returns an array containing the image data and mime type [&#39;data&#39; =&gt; &#39;&#39;, &#39;mimeType&#39; =&gt; &#39;&#39;].</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @throws Exception Thrown when WEBP support is not enabled or unsupported format.</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">protected</span> <span class="keyword">function</span> generate(<span class="keywordtype">string</span> $mimeType = <span class="keyword">null</span>, array|<span class="keywordtype">int</span> <a name="a1"></a><a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a> = []): array</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Format defaults to the original mime type</span></div>
<div class="line">        $mimeType = $mimeType ?: $this-&gt;mimeType;</div>
<div class="line"> </div>
<div class="line">        $quality = <span class="keyword">null</span>;</div>
<div class="line">        <span class="comment">// allow $options to be an int for backwards compatibility to v3</span></div>
<div class="line">        <span class="keywordflow">if</span> (is_int(<a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>)) {</div>
<div class="line">            $quality = <a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>;</div>
<div class="line">            <a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a> = [];</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// get quality if passed as an option</span></div>
<div class="line">        <span class="keywordflow">if</span> (is_array(<a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>) &amp;&amp; array_key_exists(<span class="stringliteral">&#39;quality&#39;</span>, <a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>)) {</div>
<div class="line">            $quality = intval(<a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;quality&#39;</span>]);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Ensure quality is a valid integer</span></div>
<div class="line">        <span class="keywordflow">if</span> ($quality === <span class="keyword">null</span>) {</div>
<div class="line">            $quality = 100;</div>
<div class="line">        }</div>
<div class="line">        $quality = (int) round(self::keepWithin((<span class="keywordtype">int</span>) $quality, 0, 100));</div>
<div class="line"> </div>
<div class="line">        $alpha = <span class="keyword">true</span>;</div>
<div class="line">        <span class="comment">// get alpha if passed as an option</span></div>
<div class="line">        <span class="keywordflow">if</span> (is_array(<a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>) &amp;&amp; array_key_exists(<span class="stringliteral">&#39;alpha&#39;</span>, <a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>)) {</div>
<div class="line">            $alpha = boolval(<a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;alpha&#39;</span>]);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        $interlace = <span class="keyword">null</span>; <span class="comment">// keep the same</span></div>
<div class="line">        <span class="comment">// get interlace if passed as an option</span></div>
<div class="line">        <span class="keywordflow">if</span> (is_array(<a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>) &amp;&amp; array_key_exists(<span class="stringliteral">&#39;interlace&#39;</span>, <a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>)) {</div>
<div class="line">            $interlace = boolval(<a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;interlace&#39;</span>]);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// get raw stream from image* functions in providing no path</span></div>
<div class="line">        $file = <span class="keyword">null</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Capture output</span></div>
<div class="line">        ob_start();</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Generate the image</span></div>
<div class="line">        <span class="keywordflow">switch</span>($mimeType) {</div>
<div class="line">            <span class="keywordflow">case</span> <span class="stringliteral">&#39;image/gif&#39;</span>:</div>
<div class="line">                imagesavealpha($this-&gt;image, $alpha);</div>
<div class="line">                imagegif($this-&gt;image, $file);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <span class="stringliteral">&#39;image/jpeg&#39;</span>:</div>
<div class="line">                imageinterlace($this-&gt;image, $interlace);</div>
<div class="line">                imagejpeg($this-&gt;image, $file, $quality);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <span class="stringliteral">&#39;image/png&#39;</span>:</div>
<div class="line">                $filters = -1; <span class="comment">// imagepng default</span></div>
<div class="line">                <span class="comment">// get filters if passed as an option</span></div>
<div class="line">                <span class="keywordflow">if</span> (is_array(<a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>) &amp;&amp; array_key_exists(<span class="stringliteral">&#39;filters&#39;</span>, <a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>)) {</div>
<div class="line">                    $filters = intval(<a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;filters&#39;</span>]);</div>
<div class="line">                }</div>
<div class="line">                <span class="comment">// compression param is called quality in imagepng but that would be</span></div>
<div class="line">                <span class="comment">// misleading in context of SimpleImage</span></div>
<div class="line">                $compression = -1; <span class="comment">// defaults to zlib default which is 6</span></div>
<div class="line">                <span class="comment">// get compression if passed as an option</span></div>
<div class="line">                <span class="keywordflow">if</span> (is_array(<a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>) &amp;&amp; array_key_exists(<span class="stringliteral">&#39;compression&#39;</span>, <a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>)) {</div>
<div class="line">                    $compression = intval(<a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;compression&#39;</span>]);</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">if</span> ($compression !== -1) {</div>
<div class="line">                    $compression = (int) round(self::keepWithin($compression, 0, 10));</div>
<div class="line">                }</div>
<div class="line">                imagesavealpha($this-&gt;image, $alpha);</div>
<div class="line">                imagepng($this-&gt;image, $file, $compression, $filters);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <span class="stringliteral">&#39;image/webp&#39;</span>:</div>
<div class="line">                <span class="comment">// Not all versions of PHP will have webp support enabled</span></div>
<div class="line">                <span class="keywordflow">if</span> (! function_exists(<span class="stringliteral">&#39;imagewebp&#39;</span>)) {</div>
<div class="line">                    <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(</div>
<div class="line">                        <span class="stringliteral">&#39;WEBP support is not enabled in your version of PHP.&#39;</span>,</div>
<div class="line">                        self::ERR_WEBP_NOT_ENABLED</div>
<div class="line">                    );</div>
<div class="line">                }</div>
<div class="line">                <span class="comment">// useless but recommended, see https://www.php.net/manual/en/function.imagesavealpha.php</span></div>
<div class="line">                imagesavealpha($this-&gt;image, $alpha);</div>
<div class="line">                imagewebp($this-&gt;image, $file, $quality);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <span class="stringliteral">&#39;image/bmp&#39;</span>:</div>
<div class="line">            <span class="keywordflow">case</span> <span class="stringliteral">&#39;image/x-ms-bmp&#39;</span>:</div>
<div class="line">            <span class="keywordflow">case</span> <span class="stringliteral">&#39;image/x-windows-bmp&#39;</span>:</div>
<div class="line">                <span class="comment">// Not all versions of PHP support bmp</span></div>
<div class="line">                <span class="keywordflow">if</span> (! function_exists(<span class="stringliteral">&#39;imagebmp&#39;</span>)) {</div>
<div class="line">                    <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(</div>
<div class="line">                        <span class="stringliteral">&#39;BMP support is not available in your version of PHP.&#39;</span>,</div>
<div class="line">                        self::ERR_UNSUPPORTED_FORMAT</div>
<div class="line">                    );</div>
<div class="line">                }</div>
<div class="line">                $compression = <span class="keyword">true</span>; <span class="comment">// imagebmp default</span></div>
<div class="line">                <span class="comment">// get compression if passed as an option</span></div>
<div class="line">                <span class="keywordflow">if</span> (is_array(<a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>) &amp;&amp; array_key_exists(<span class="stringliteral">&#39;compression&#39;</span>, <a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>)) {</div>
<div class="line">                    $compression = is_int(<a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;compression&#39;</span>]) ?</div>
<div class="line">                        <a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;compression&#39;</span>] &gt; 0 : boolval(<a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;compression&#39;</span>]);</div>
<div class="line">                }</div>
<div class="line">                imageinterlace($this-&gt;image, $interlace);</div>
<div class="line">                imagebmp($this-&gt;image, $file, $compression);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <span class="stringliteral">&#39;image/avif&#39;</span>:</div>
<div class="line">                <span class="comment">// Not all versions of PHP support avif</span></div>
<div class="line">                <span class="keywordflow">if</span> (! function_exists(<span class="stringliteral">&#39;imageavif&#39;</span>)) {</div>
<div class="line">                    <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(</div>
<div class="line">                        <span class="stringliteral">&#39;AVIF support is not available in your version of PHP.&#39;</span>,</div>
<div class="line">                        self::ERR_UNSUPPORTED_FORMAT</div>
<div class="line">                    );</div>
<div class="line">                }</div>
<div class="line">                $speed = -1; <span class="comment">// imageavif default</span></div>
<div class="line">                <span class="comment">// get speed if passed as an option</span></div>
<div class="line">                <span class="keywordflow">if</span> (is_array(<a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>) &amp;&amp; array_key_exists(<span class="stringliteral">&#39;speed&#39;</span>, <a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>)) {</div>
<div class="line">                    $speed = intval(<a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;speed&#39;</span>]);</div>
<div class="line">                    $speed = self::keepWithin($speed, 0, 10);</div>
<div class="line">                }</div>
<div class="line">                <span class="comment">// useless but recommended, see https://www.php.net/manual/en/function.imagesavealpha.php</span></div>
<div class="line">                imagesavealpha($this-&gt;image, $alpha);</div>
<div class="line">                imageavif($this-&gt;image, $file, $quality, $speed);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">default</span>:</div>
<div class="line">                <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&#39;Unsupported format: &#39;</span>.$mimeType, self::ERR_UNSUPPORTED_FORMAT);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Stop capturing</span></div>
<div class="line">        <a name="a2"></a><a class="code" href="admin_2includes_2stats_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a> = ob_get_contents();</div>
<div class="line">        ob_end_clean();</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> [</div>
<div class="line">            <span class="stringliteral">&#39;data&#39;</span> =&gt; <a class="code" href="admin_2includes_2stats_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a>,</div>
<div class="line">            <span class="stringliteral">&#39;mimeType&#39;</span> =&gt; $mimeType,</div>
<div class="line">        ];</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Generates a data URI.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @param  string|null  $mimeType The image format to output as a mime type (defaults to the original mime type).</span></div>
<div class="line"><span class="comment">     * @param  array|int  $options Array or Image quality as a percentage (default 100).</span></div>
<div class="line"><span class="comment">     * @return string Returns a string containing a data URI.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @throws Exception</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> toDataUri(<span class="keywordtype">string</span> $mimeType = <span class="keyword">null</span>, array|<span class="keywordtype">int</span> <a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a> = 100): string</div>
<div class="line">    {</div>
<div class="line">        $image = $this-&gt;generate($mimeType, <a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> <span class="stringliteral">&#39;data:&#39;</span>.$image[<span class="stringliteral">&#39;mimeType&#39;</span>].<span class="stringliteral">&#39;;base64,&#39;</span>.base64_encode($image[<span class="stringliteral">&#39;data&#39;</span>]);</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Forces the image to be downloaded to the clients machine. Must be called before any output is sent to the screen.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @param  string  $filename The filename (without path) to send to the client (e.g. &#39;image.jpeg&#39;).</span></div>
<div class="line"><span class="comment">     * @param  string|null  $mimeType The image format to output as a mime type (defaults to the original mime type).</span></div>
<div class="line"><span class="comment">     * @param  array|int  $options Array or Image quality as a percentage (default 100).</span></div>
<div class="line"><span class="comment">     * @return SimpleImage</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @throws Exception</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> toDownload(<span class="keywordtype">string</span> <a name="a3"></a><a class="code" href="actions_8php.html#a0722441477f957078ee2437054556cbc">$filename</a>, <span class="keywordtype">string</span> $mimeType = <span class="keyword">null</span>, array|<span class="keywordtype">int</span> <a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a> = 100): static</div>
<div class="line">    {</div>
<div class="line">        $image = $this-&gt;generate($mimeType, <a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Set download headers</span></div>
<div class="line">        header(<span class="stringliteral">&#39;Cache-Control: must-revalidate, post-check=0, pre-check=0&#39;</span>);</div>
<div class="line">        header(<span class="stringliteral">&#39;Content-Description: File Transfer&#39;</span>);</div>
<div class="line">        header(<span class="stringliteral">&#39;Content-Length: &#39;</span>.strlen($image[<span class="stringliteral">&#39;data&#39;</span>]));</div>
<div class="line">        header(<span class="stringliteral">&#39;Content-Transfer-Encoding: Binary&#39;</span>);</div>
<div class="line">        header(<span class="stringliteral">&#39;Content-Type: application/octet-stream&#39;</span>);</div>
<div class="line">        header(<span class="stringliteral">&quot;Content-Disposition: attachment; filename=\&quot;$filename\&quot;&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        echo $image[<span class="stringliteral">&#39;data&#39;</span>];</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> $this;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Writes the image to a file.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @param  string  $file The image format to output as a mime type (defaults to the original mime type).</span></div>
<div class="line"><span class="comment">     * @param  string|null  $mimeType Image quality as a percentage (default 100).</span></div>
<div class="line"><span class="comment">     * @param  array|int  $options Array or Image quality as a percentage (default 100).</span></div>
<div class="line"><span class="comment">     * @return SimpleImage</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @throws Exception Thrown if failed write to file.</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> toFile(<span class="keywordtype">string</span> $file, <span class="keywordtype">string</span> $mimeType = <span class="keyword">null</span>, array|<span class="keywordtype">int</span> <a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a> = 100): static</div>
<div class="line">    {</div>
<div class="line">        $image = $this-&gt;generate($mimeType, <a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Save the image to file</span></div>
<div class="line">        <span class="keywordflow">if</span> (! file_put_contents($file, $image[<span class="stringliteral">&#39;data&#39;</span>])) {</div>
<div class="line">            <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;Failed to write image to file: $file&quot;</span>, self::ERR_WRITE);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> $this;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Outputs the image to the screen. Must be called before any output is sent to the screen.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @param  string|null  $mimeType The image format to output as a mime type (defaults to the original mime type).</span></div>
<div class="line"><span class="comment">     * @param  array|int  $options Array or Image quality as a percentage (default 100).</span></div>
<div class="line"><span class="comment">     * @return SimpleImage</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @throws Exception</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> toScreen(<span class="keywordtype">string</span> $mimeType = <span class="keyword">null</span>, array|<span class="keywordtype">int</span> <a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a> = 100): static</div>
<div class="line">    {</div>
<div class="line">        $image = $this-&gt;generate($mimeType, <a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Output the image to stdout</span></div>
<div class="line">        header(<span class="stringliteral">&#39;Content-Type: &#39;</span>.$image[<span class="stringliteral">&#39;mimeType&#39;</span>]);</div>
<div class="line">        echo $image[<span class="stringliteral">&#39;data&#39;</span>];</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> $this;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Generates an image string.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @param  string|null  $mimeType The image format to output as a mime type (defaults to the original mime type).</span></div>
<div class="line"><span class="comment">     * @param  array|int  $options Array or Image quality as a percentage (default 100).</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @throws Exception</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> toString(<span class="keywordtype">string</span> $mimeType = <span class="keyword">null</span>, array|<span class="keywordtype">int</span> <a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a> = 100): string</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> $this-&gt;generate($mimeType, <a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>)[<span class="stringliteral">&#39;data&#39;</span>];</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    //////////////////////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment"></span>    <span class="comment">// Utilities</span><span class="comment"></span></div>
<div class="line"><span class="comment">    //////////////////////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment"></span><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Ensures a numeric value is always within the min and max range.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @param  int|float  $value A numeric value to test.</span></div>
<div class="line"><span class="comment">     * @param  int|float  $min The minimum allowed value.</span></div>
<div class="line"><span class="comment">     * @param  int|float  $max The maximum allowed value.</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">function</span> keepWithin(<span class="keywordtype">int</span>|<span class="keywordtype">float</span> <a class="code" href="widget-edit_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a>, <span class="keywordtype">int</span>|<span class="keywordtype">float</span> $min, <span class="keywordtype">int</span>|<span class="keywordtype">float</span> $max): int|float</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="widget-edit_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a> &lt; $min) {</div>
<div class="line">            <span class="keywordflow">return</span> $min;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="widget-edit_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a> &gt; $max) {</div>
<div class="line">            <span class="keywordflow">return</span> $max;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="widget-edit_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a>;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Gets the image&#39;s current aspect ratio.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @return float|int Returns the aspect ratio as a float.</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> getAspectRatio(): float|int</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> $this-&gt;getWidth() / $this-&gt;getHeight();</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Gets the image&#39;s exif data.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @return array|null Returns an array of exif data or null if no data is available.</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> getExif(): ?array</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> $this-&gt;exif ?? <span class="keyword">null</span>;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Gets the image&#39;s current height.</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> getHeight(): int</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> (<span class="keywordtype">int</span>) imagesy($this-&gt;image);</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Gets the mime type of the loaded image.</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> getMimeType(): string</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> $this-&gt;mimeType;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Gets the image&#39;s current orientation.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @return string One of the values: &#39;landscape&#39;, &#39;portrait&#39;, or &#39;square&#39;</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> getOrientation(): string</div>
<div class="line">    {</div>
<div class="line">        $width = $this-&gt;getWidth();</div>
<div class="line">        $height = $this-&gt;getHeight();</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> ($width &gt; $height) {</div>
<div class="line">            <span class="keywordflow">return</span> <span class="stringliteral">&#39;landscape&#39;</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> ($width &lt; $height) {</div>
<div class="line">            <span class="keywordflow">return</span> <span class="stringliteral">&#39;portrait&#39;</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> <span class="stringliteral">&#39;square&#39;</span>;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Gets the resolution of the image</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @return array|bool The resolution as an array of integers: [96, 96]</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> getResolution(): bool|array</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> imageresolution($this-&gt;image);</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Gets the image&#39;s current width.</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> getWidth(): int</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> (<span class="keywordtype">int</span>) imagesx($this-&gt;image);</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    //////////////////////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment"></span>    <span class="comment">// Manipulation</span><span class="comment"></span></div>
<div class="line"><span class="comment">    //////////////////////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment"></span><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Same as PHP&#39;s imagecopymerge, but works with transparent images. Used internally for overlay.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @param  resource  $dstIm Destination image link resource.</span></div>
<div class="line"><span class="comment">     * @param  resource  $srcIm Source image link resource.</span></div>
<div class="line"><span class="comment">     * @param  int  $dstX x-coordinate of destination point.</span></div>
<div class="line"><span class="comment">     * @param  int  $dstY y-coordinate of destination point.</span></div>
<div class="line"><span class="comment">     * @param  int  $srcX x-coordinate of source point.</span></div>
<div class="line"><span class="comment">     * @param  int  $srcY y-coordinate of source point.</span></div>
<div class="line"><span class="comment">     * @param  int  $srcW Source width.</span></div>
<div class="line"><span class="comment">     * @param  int  $srcH Source height.</span></div>
<div class="line"><span class="comment">     * @return bool true if success.</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">function</span> imageCopyMergeAlpha($dstIm, $srcIm, <span class="keywordtype">int</span> $dstX, <span class="keywordtype">int</span> $dstY, <span class="keywordtype">int</span> $srcX, <span class="keywordtype">int</span> $srcY, <span class="keywordtype">int</span> $srcW, <span class="keywordtype">int</span> $srcH, <span class="keywordtype">int</span> $pct): bool</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Are we merging with transparency?</span></div>
<div class="line">        <span class="keywordflow">if</span> ($pct &lt; 100) {</div>
<div class="line">            <span class="comment">// Disable alpha blending and &quot;colorize&quot; the image using a transparent color</span></div>
<div class="line">            imagealphablending($srcIm, <span class="keyword">false</span>);</div>
<div class="line">            imagefilter($srcIm, IMG_FILTER_COLORIZE, 0, 0, 0, round(127 * ((100 - $pct) / 100)));</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        imagecopy($dstIm, $srcIm, $dstX, $dstY, $srcX, $srcY, $srcW, $srcH);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Rotates an image so the orientation will be correct based on its exif data. It is safe to call</span></div>
<div class="line"><span class="comment">     * this method on images that don&#39;t have exif data (no changes will be made).</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @return SimpleImage</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @throws Exception</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> autoOrient(): static</div>
<div class="line">    {</div>
<div class="line">        $exif = $this-&gt;getExif();</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (! $exif || ! isset($exif[<span class="stringliteral">&#39;Orientation&#39;</span>])) {</div>
<div class="line">            <span class="keywordflow">return</span> $this;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">switch</span>($exif[<span class="stringliteral">&#39;Orientation&#39;</span>]) {</div>
<div class="line">            <span class="keywordflow">case</span> 1: <span class="comment">// Do nothing!</span></div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> 2: <span class="comment">// Flip horizontally</span></div>
<div class="line">                $this-&gt;flip(<span class="charliteral">&#39;x&#39;</span>);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> 3: <span class="comment">// Rotate 180 degrees</span></div>
<div class="line">                $this-&gt;rotate(180);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> 4: <span class="comment">// Flip vertically</span></div>
<div class="line">                $this-&gt;flip(<span class="charliteral">&#39;y&#39;</span>);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> 5: <span class="comment">// Rotate 90 degrees clockwise and flip vertically</span></div>
<div class="line">                $this-&gt;flip(<span class="charliteral">&#39;y&#39;</span>)-&gt;rotate(90);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> 6: <span class="comment">// Rotate 90 clockwise</span></div>
<div class="line">                $this-&gt;rotate(90);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> 7: <span class="comment">// Rotate 90 clockwise and flip horizontally</span></div>
<div class="line">                $this-&gt;flip(<span class="charliteral">&#39;x&#39;</span>)-&gt;rotate(90);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> 8: <span class="comment">// Rotate 90 counterclockwise</span></div>
<div class="line">                $this-&gt;rotate(-90);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> $this;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Proportionally resize the image to fit inside a specific width and height.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @param  int  $maxWidth The maximum width the image can be.</span></div>
<div class="line"><span class="comment">     * @param  int  $maxHeight The maximum height the image can be.</span></div>
<div class="line"><span class="comment">     * @return SimpleImage</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> bestFit(<span class="keywordtype">int</span> $maxWidth, <span class="keywordtype">int</span> $maxHeight): static</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// If the image already fits, there&#39;s nothing to do</span></div>
<div class="line">        <span class="keywordflow">if</span> ($this-&gt;getWidth() &lt;= $maxWidth &amp;&amp; $this-&gt;getHeight() &lt;= $maxHeight) {</div>
<div class="line">            <span class="keywordflow">return</span> $this;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Calculate max width or height based on orientation</span></div>
<div class="line">        <span class="keywordflow">if</span> ($this-&gt;getOrientation() === <span class="stringliteral">&#39;portrait&#39;</span>) {</div>
<div class="line">            $height = $maxHeight;</div>
<div class="line">            $width = (int) round($maxHeight * $this-&gt;getAspectRatio());</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            $width = $maxWidth;</div>
<div class="line">            $height = (int) round($maxWidth / $this-&gt;getAspectRatio());</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Reduce to max width</span></div>
<div class="line">        <span class="keywordflow">if</span> ($width &gt; $maxWidth) {</div>
<div class="line">            $width = $maxWidth;</div>
<div class="line">            $height = (int) round($width / $this-&gt;getAspectRatio());</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Reduce to max height</span></div>
<div class="line">        <span class="keywordflow">if</span> ($height &gt; $maxHeight) {</div>
<div class="line">            $height = $maxHeight;</div>
<div class="line">            $width = (int) round($height * $this-&gt;getAspectRatio());</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> $this-&gt;resize($width, $height);</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Crop the image.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @param  int|float  $x1 Top left x coordinate.</span></div>
<div class="line"><span class="comment">     * @param  int|float  $y1 Top left y coordinate.</span></div>
<div class="line"><span class="comment">     * @param  int|float  $x2 Bottom right x coordinate.</span></div>
<div class="line"><span class="comment">     * @param  int|float  $y2 Bottom right x coordinate.</span></div>
<div class="line"><span class="comment">     * @return SimpleImage</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> crop(<span class="keywordtype">int</span>|<span class="keywordtype">float</span> $x1, <span class="keywordtype">int</span>|<span class="keywordtype">float</span> $y1, <span class="keywordtype">int</span>|<span class="keywordtype">float</span> $x2, <span class="keywordtype">int</span>|<span class="keywordtype">float</span> $y2): static</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Keep crop within image dimensions</span></div>
<div class="line">        $x1 = self::keepWithin($x1, 0, $this-&gt;getWidth());</div>
<div class="line">        $x2 = self::keepWithin($x2, 0, $this-&gt;getWidth());</div>
<div class="line">        $y1 = self::keepWithin($y1, 0, $this-&gt;getHeight());</div>
<div class="line">        $y2 = self::keepWithin($y2, 0, $this-&gt;getHeight());</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Avoid using native imagecrop() because of a bug with PNG transparency</span></div>
<div class="line">        $dstW = abs($x2 - $x1);</div>
<div class="line">        $dstH = abs($y2 - $y1);</div>
<div class="line">        $newImage = imagecreatetruecolor((<span class="keywordtype">int</span>) $dstW, (<span class="keywordtype">int</span>) $dstH);</div>
<div class="line">        $transparentColor = imagecolorallocatealpha($newImage, 0, 0, 0, 127);</div>
<div class="line">        imagecolortransparent($newImage, $transparentColor ?: <span class="keyword">null</span>);</div>
<div class="line">        imagefill($newImage, 0, 0, $transparentColor);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Crop it</span></div>
<div class="line">        imagecopyresampled(</div>
<div class="line">            $newImage,</div>
<div class="line">            $this-&gt;image,</div>
<div class="line">            0,</div>
<div class="line">            0,</div>
<div class="line">            (<span class="keywordtype">int</span>) round(min($x1, $x2)),</div>
<div class="line">            (<span class="keywordtype">int</span>) round(min($y1, $y2)),</div>
<div class="line">            (<span class="keywordtype">int</span>) $dstW,</div>
<div class="line">            (<span class="keywordtype">int</span>) $dstH,</div>
<div class="line">            (<span class="keywordtype">int</span>) $dstW,</div>
<div class="line">            (<span class="keywordtype">int</span>) $dstH</div>
<div class="line">        );</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Swap out the new image</span></div>
<div class="line">        $this-&gt;image = $newImage;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> $this;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Applies a duotone filter to the image.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @param  string|array  $lightColor The lightest color in the duotone.</span></div>
<div class="line"><span class="comment">     * @param  string|array  $darkColor The darkest color in the duotone.</span></div>
<div class="line"><span class="comment">     * @return SimpleImage</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @throws Exception</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> duotone(<span class="keywordtype">string</span>|array $lightColor, <span class="keywordtype">string</span>|array $darkColor): static</div>
<div class="line">    {</div>
<div class="line">        $lightColor = self::normalizeColor($lightColor);</div>
<div class="line">        $darkColor = self::normalizeColor($darkColor);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Calculate averages between light and dark colors</span></div>
<div class="line">        $redAvg = $lightColor[<span class="stringliteral">&#39;red&#39;</span>] - $darkColor[<span class="stringliteral">&#39;red&#39;</span>];</div>
<div class="line">        $greenAvg = $lightColor[<span class="stringliteral">&#39;green&#39;</span>] - $darkColor[<span class="stringliteral">&#39;green&#39;</span>];</div>
<div class="line">        $blueAvg = $lightColor[<span class="stringliteral">&#39;blue&#39;</span>] - $darkColor[<span class="stringliteral">&#39;blue&#39;</span>];</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Create a matrix of all possible duotone colors based on gray values</span></div>
<div class="line">        $pixels = [];</div>
<div class="line">        <span class="keywordflow">for</span> (<a name="a4"></a><a class="code" href="widget-edit_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a> = 0; <a class="code" href="widget-edit_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a> &lt;= 255; <a class="code" href="widget-edit_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a>++) {</div>
<div class="line">            $grayAvg = <a class="code" href="widget-edit_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a> / 255;</div>
<div class="line">            $pixels[<span class="stringliteral">&#39;red&#39;</span>][<a class="code" href="widget-edit_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a>] = $darkColor[<span class="stringliteral">&#39;red&#39;</span>] + $grayAvg * $redAvg;</div>
<div class="line">            $pixels[<span class="stringliteral">&#39;green&#39;</span>][<a class="code" href="widget-edit_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a>] = $darkColor[<span class="stringliteral">&#39;green&#39;</span>] + $grayAvg * $greenAvg;</div>
<div class="line">            $pixels[<span class="stringliteral">&#39;blue&#39;</span>][<a class="code" href="widget-edit_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a>] = $darkColor[<span class="stringliteral">&#39;blue&#39;</span>] + $grayAvg * $blueAvg;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Apply the filter pixel by pixel</span></div>
<div class="line">        <span class="keywordflow">for</span> ($x = 0; $x &lt; $this-&gt;getWidth(); $x++) {</div>
<div class="line">            <span class="keywordflow">for</span> ($y = 0; $y &lt; $this-&gt;getHeight(); $y++) {</div>
<div class="line">                $rgb = $this-&gt;getColorAt($x, $y);</div>
<div class="line">                $gray = min(255, round(0.299 * $rgb[<span class="stringliteral">&#39;red&#39;</span>] + 0.114 * $rgb[<span class="stringliteral">&#39;blue&#39;</span>] + 0.587 * $rgb[<span class="stringliteral">&#39;green&#39;</span>]));</div>
<div class="line">                $this-&gt;dot($x, $y, [</div>
<div class="line">                    <span class="stringliteral">&#39;red&#39;</span> =&gt; $pixels[<span class="stringliteral">&#39;red&#39;</span>][$gray],</div>
<div class="line">                    <span class="stringliteral">&#39;green&#39;</span> =&gt; $pixels[<span class="stringliteral">&#39;green&#39;</span>][$gray],</div>
<div class="line">                    <span class="stringliteral">&#39;blue&#39;</span> =&gt; $pixels[<span class="stringliteral">&#39;blue&#39;</span>][$gray],</div>
<div class="line">                ]);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> $this;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Proportionally resize the image to a specific width.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @param  int  $width The width to resize the image to.</span></div>
<div class="line"><span class="comment">     * @return SimpleImage</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     *@deprecated</span></div>
<div class="line"><span class="comment">     *    This method was deprecated in version 3.2.2 and will be removed in version 4.0.</span></div>
<div class="line"><span class="comment">     *    Please use `resize(null, $height)` instead.</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> fitToWidth(<span class="keywordtype">int</span> $width): static</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> $this-&gt;resize($width);</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Flip the image horizontally or vertically.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @param  string  $direction The direction to flip: x|y|both.</span></div>
<div class="line"><span class="comment">     * @return SimpleImage</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> flip(<span class="keywordtype">string</span> $direction): static</div>
<div class="line">    {</div>
<div class="line">        match ($direction) {</div>
<div class="line">            <span class="charliteral">&#39;x&#39;</span> =&gt; imageflip($this-&gt;image, IMG_FLIP_HORIZONTAL),</div>
<div class="line">            <span class="charliteral">&#39;y&#39;</span> =&gt; imageflip($this-&gt;image, IMG_FLIP_VERTICAL),</div>
<div class="line">            <span class="stringliteral">&#39;both&#39;</span> =&gt; imageflip($this-&gt;image, IMG_FLIP_BOTH),</div>
<div class="line">            <span class="keywordflow">default</span> =&gt; $this,</div>
<div class="line">        };</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> $this;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Reduces the image to a maximum number of colors.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @param  int  $max The maximum number of colors to use.</span></div>
<div class="line"><span class="comment">     * @param  bool  $dither Whether or not to use a dithering effect (default true).</span></div>
<div class="line"><span class="comment">     * @return SimpleImage</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> maxColors(<span class="keywordtype">int</span> $max, <span class="keywordtype">bool</span> $dither = <span class="keyword">true</span>): static</div>
<div class="line">    {</div>
<div class="line">        imagetruecolortopalette($this-&gt;image, $dither, max(1, $max));</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> $this;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Place an image on top of the current image.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @param  string|SimpleImage  $overlay The image to overlay. This can be a filename, a data URI, or a SimpleImage object.</span></div>
<div class="line"><span class="comment">     * @param  string  $anchor The anchor point: &#39;center&#39;, &#39;top&#39;, &#39;bottom&#39;, &#39;left&#39;, &#39;right&#39;, &#39;top left&#39;, &#39;top right&#39;, &#39;bottom left&#39;, &#39;bottom right&#39; (default &#39;center&#39;).</span></div>
<div class="line"><span class="comment">     * @param  float|int  $opacity The opacity level of the overlay 0-1 (default 1).</span></div>
<div class="line"><span class="comment">     * @param  int  $xOffset Horizontal offset in pixels (default 0).</span></div>
<div class="line"><span class="comment">     * @param  int  $yOffset Vertical offset in pixels (default 0).</span></div>
<div class="line"><span class="comment">     * @param  bool  $calculateOffsetFromEdge Calculate Offset referring to the edges of the image (default false).</span></div>
<div class="line"><span class="comment">     * @return SimpleImage</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @throws Exception</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> overlay(<span class="keywordtype">string</span>|SimpleImage $overlay, <span class="keywordtype">string</span> $anchor = <span class="stringliteral">&#39;center&#39;</span>, <span class="keywordtype">float</span>|<span class="keywordtype">int</span> $opacity = 1, <span class="keywordtype">int</span> $xOffset = 0, <span class="keywordtype">int</span> $yOffset = 0, <span class="keywordtype">bool</span> $calculateOffsetFromEdge = <span class="keyword">false</span>): static</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Load overlay image</span></div>
<div class="line">        <span class="keywordflow">if</span> (! ($overlay instanceof SimpleImage)) {</div>
<div class="line">            $overlay = <span class="keyword">new</span> SimpleImage($overlay);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Convert opacity</span></div>
<div class="line">        $opacity = (int) round(self::keepWithin($opacity, 0, 1) * 100);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Get available space</span></div>
<div class="line">        $spaceX = $this-&gt;getWidth() - $overlay-&gt;getWidth();</div>
<div class="line">        $spaceY = $this-&gt;getHeight() - $overlay-&gt;getHeight();</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Set default center</span></div>
<div class="line">        $x = (int) round(($spaceX / 2) + ($calculateOffsetFromEdge ? 0 : $xOffset));</div>
<div class="line">        $y = (int) round(($spaceY / 2) + ($calculateOffsetFromEdge ? 0 : $yOffset));</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Determine if top|bottom</span></div>
<div class="line">        <span class="keywordflow">if</span> (str_contains($anchor, <span class="stringliteral">&#39;top&#39;</span>)) {</div>
<div class="line">            $y = $yOffset;</div>
<div class="line">        } elseif (str_contains($anchor, <span class="stringliteral">&#39;bottom&#39;</span>)) {</div>
<div class="line">            $y = $spaceY + ($calculateOffsetFromEdge ? -$yOffset : $yOffset);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Determine if left|right</span></div>
<div class="line">        <span class="keywordflow">if</span> (str_contains($anchor, <span class="stringliteral">&#39;left&#39;</span>)) {</div>
<div class="line">            $x = $xOffset;</div>
<div class="line">        } elseif (str_contains($anchor, <span class="stringliteral">&#39;right&#39;</span>)) {</div>
<div class="line">            $x = $spaceX + ($calculateOffsetFromEdge ? -$xOffset : $xOffset);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Perform the overlay</span></div>
<div class="line">        self::imageCopyMergeAlpha(</div>
<div class="line">            $this-&gt;image,</div>
<div class="line">            $overlay-&gt;image,</div>
<div class="line">            $x, $y,</div>
<div class="line">            0, 0,</div>
<div class="line">            $overlay-&gt;getWidth(),</div>
<div class="line">            $overlay-&gt;getHeight(),</div>
<div class="line">            $opacity</div>
<div class="line">        );</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> $this;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Resize an image to the specified dimensions. If only one dimension is specified, the image will be resized proportionally.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @param  int|null  $width The new image width.</span></div>
<div class="line"><span class="comment">     * @param  int|null  $height The new image height.</span></div>
<div class="line"><span class="comment">     * @return SimpleImage</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> resize(<span class="keywordtype">int</span> $width = <span class="keyword">null</span>, <span class="keywordtype">int</span> $height = <span class="keyword">null</span>): static</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// No dimensions specified</span></div>
<div class="line">        <span class="keywordflow">if</span> (! $width &amp;&amp; ! $height) {</div>
<div class="line">            <span class="keywordflow">return</span> $this;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Resize to width</span></div>
<div class="line">        <span class="keywordflow">if</span> ($width &amp;&amp; ! $height) {</div>
<div class="line">            $height = (int) round($width / $this-&gt;getAspectRatio());</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Resize to height</span></div>
<div class="line">        <span class="keywordflow">if</span> (! $width &amp;&amp; $height) {</div>
<div class="line">            $width = (int) round($height * $this-&gt;getAspectRatio());</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// If the dimensions are the same, there&#39;s no need to resize</span></div>
<div class="line">        <span class="keywordflow">if</span> ($this-&gt;getWidth() === $width &amp;&amp; $this-&gt;getHeight() === $height) {</div>
<div class="line">            <span class="keywordflow">return</span> $this;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// We can&#39;t use imagescale because it doesn&#39;t seem to preserve transparency properly. The</span></div>
<div class="line">        <span class="comment">// workaround is to create a new truecolor image, allocate a transparent color, and copy the</span></div>
<div class="line">        <span class="comment">// image over to it using imagecopyresampled.</span></div>
<div class="line">        $newImage = imagecreatetruecolor($width, $height);</div>
<div class="line">        $transparentColor = imagecolorallocatealpha($newImage, 0, 0, 0, 127);</div>
<div class="line">        imagecolortransparent($newImage, $transparentColor);</div>
<div class="line">        imagefill($newImage, 0, 0, $transparentColor);</div>
<div class="line">        imagecopyresampled(</div>
<div class="line">            $newImage,</div>
<div class="line">            $this-&gt;image,</div>
<div class="line">            0, 0, 0, 0,</div>
<div class="line">            $width,</div>
<div class="line">            $height,</div>
<div class="line">            $this-&gt;getWidth(),</div>
<div class="line">            $this-&gt;getHeight()</div>
<div class="line">        );</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Swap out the new image</span></div>
<div class="line">        $this-&gt;image = $newImage;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> $this;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Sets an image&#39;s resolution, as per https://www.php.net/manual/en/function.imageresolution.php</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @param  int  $res_x The horizontal resolution in DPI.</span></div>
<div class="line"><span class="comment">     * @param  int|null  $res_y The vertical resolution in DPI</span></div>
<div class="line"><span class="comment">     * @return SimpleImage</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> resolution(<span class="keywordtype">int</span> $res_x, <span class="keywordtype">int</span> $res_y = <span class="keyword">null</span>): static</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (is_null($res_y)) {</div>
<div class="line">            imageresolution($this-&gt;image, $res_x);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            imageresolution($this-&gt;image, $res_x, $res_y);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> $this;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Rotates the image.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @param  int  $angle The angle of rotation (-360 - 360).</span></div>
<div class="line"><span class="comment">     * @param  string|array  $backgroundColor The background color to use for the uncovered zone area after rotation (default &#39;transparent&#39;).</span></div>
<div class="line"><span class="comment">     * @return SimpleImage</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @throws Exception</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> rotate(<span class="keywordtype">int</span> $angle, <span class="keywordtype">string</span>|array $backgroundColor = <span class="stringliteral">&#39;transparent&#39;</span>): static</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Rotate the image on a canvas with the desired background color</span></div>
<div class="line">        $backgroundColor = $this-&gt;allocateColor($backgroundColor);</div>
<div class="line"> </div>
<div class="line">        $this-&gt;image = imagerotate(</div>
<div class="line">            $this-&gt;image,</div>
<div class="line">            -(self::keepWithin($angle, -360, 360)),</div>
<div class="line">            $backgroundColor</div>
<div class="line">        );</div>
<div class="line">        imagecolortransparent($this-&gt;image, imagecolorallocatealpha($this-&gt;image, 0, 0, 0, 127));</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> $this;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Adds text to the image.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @param  string  $text The desired text.</span></div>
<div class="line"><span class="comment">     * @param  array  $options</span></div>
<div class="line"><span class="comment">     *    An array of options.</span></div>
<div class="line"><span class="comment">     *       - fontFile* (string) - The TrueType (or compatible) font file to use.</span></div>
<div class="line"><span class="comment">     *       - size (integer) - The size of the font in pixels (default 12).</span></div>
<div class="line"><span class="comment">     *       - color (string|array) - The text color (default black).</span></div>
<div class="line"><span class="comment">     *       - anchor (string) - The anchor point: &#39;center&#39;, &#39;top&#39;, &#39;bottom&#39;, &#39;left&#39;, &#39;right&#39;, &#39;top left&#39;, &#39;top right&#39;, &#39;bottom left&#39;, &#39;bottom right&#39; (default &#39;center&#39;).</span></div>
<div class="line"><span class="comment">     *       - xOffset (integer) - The horizontal offset in pixels (default 0).</span></div>
<div class="line"><span class="comment">     *       - yOffset (integer) - The vertical offset in pixels (default 0).</span></div>
<div class="line"><span class="comment">     *       - shadow (array) - Text shadow params.</span></div>
<div class="line"><span class="comment">     *          - x* (integer) - Horizontal offset in pixels.</span></div>
<div class="line"><span class="comment">     *          - y* (integer) - Vertical offset in pixels.</span></div>
<div class="line"><span class="comment">     *          - color* (string|array) - The text shadow color.</span></div>
<div class="line"><span class="comment">     *       - $calculateOffsetFromEdge (bool) - Calculate offsets from the edge of the image (default false).</span></div>
<div class="line"><span class="comment">     *       - $baselineAlign (bool) - Align the text font with the baseline. (default true).</span></div>
<div class="line"><span class="comment">     * @param  array|null  $boundary</span></div>
<div class="line"><span class="comment">     *    If passed, this variable will contain an array with coordinates that surround the text: [x1, y1, x2, y2, width, height].</span></div>
<div class="line"><span class="comment">     *    This can be used for calculating the text&#39;s position after it gets added to the image.</span></div>
<div class="line"><span class="comment">     * @return SimpleImage</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @throws Exception</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> text(<span class="keywordtype">string</span> $text, array <a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>, array &amp;$boundary = <span class="keyword">null</span>): static</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Check for freetype support</span></div>
<div class="line">        <span class="keywordflow">if</span> (! function_exists(<span class="stringliteral">&#39;imagettftext&#39;</span>)) {</div>
<div class="line">            <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(</div>
<div class="line">                <span class="stringliteral">&#39;Freetype support is not enabled in your version of PHP.&#39;</span>,</div>
<div class="line">                self::ERR_FREETYPE_NOT_ENABLED</div>
<div class="line">            );</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Default options</span></div>
<div class="line">        <a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a> = array_merge([</div>
<div class="line">            <span class="stringliteral">&#39;fontFile&#39;</span> =&gt; <span class="keyword">null</span>,</div>
<div class="line">            <span class="stringliteral">&#39;size&#39;</span> =&gt; 12,</div>
<div class="line">            <span class="stringliteral">&#39;color&#39;</span> =&gt; <span class="stringliteral">&#39;black&#39;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;anchor&#39;</span> =&gt; <span class="stringliteral">&#39;center&#39;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;xOffset&#39;</span> =&gt; 0,</div>
<div class="line">            <span class="stringliteral">&#39;yOffset&#39;</span> =&gt; 0,</div>
<div class="line">            <span class="stringliteral">&#39;shadow&#39;</span> =&gt; <span class="keyword">null</span>,</div>
<div class="line">            <span class="stringliteral">&#39;calculateOffsetFromEdge&#39;</span> =&gt; <span class="keyword">false</span>,</div>
<div class="line">            <span class="stringliteral">&#39;baselineAlign&#39;</span> =&gt; <span class="keyword">true</span>,</div>
<div class="line">        ], <a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Extract and normalize options</span></div>
<div class="line">        $fontFile = <a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;fontFile&#39;</span>];</div>
<div class="line">        $size = (<a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;size&#39;</span>] / 96) * 72; <span class="comment">// Convert px to pt (72pt per inch, 96px per inch)</span></div>
<div class="line">        $color = $this-&gt;allocateColor(<a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;color&#39;</span>]);</div>
<div class="line">        $anchor = <a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;anchor&#39;</span>];</div>
<div class="line">        $xOffset = <a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;xOffset&#39;</span>];</div>
<div class="line">        $yOffset = <a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;yOffset&#39;</span>];</div>
<div class="line">        $calculateOffsetFromEdge = <a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;calculateOffsetFromEdge&#39;</span>];</div>
<div class="line">        $baselineAlign = <a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;baselineAlign&#39;</span>];</div>
<div class="line">        $angle = 0;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Calculate the bounding box dimensions</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">        <span class="comment">// Since imagettfbox() returns a bounding box from the text&#39;s baseline, we can end up with</span></div>
<div class="line">        <span class="comment">// different heights for different strings of the same font size. For example, &#39;type&#39; will often</span></div>
<div class="line">        <span class="comment">// be taller than &#39;text&#39; because the former has a descending letter.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">        <span class="comment">// To compensate for this, we created a temporary bounding box to measure the maximum height</span></div>
<div class="line">        <span class="comment">// that the font used can occupy. Based on this, we can adjust the text vertically so that it</span></div>
<div class="line">        <span class="comment">// appears inside the box with a good consistency.</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">        <span class="comment">// See: https://github.com/claviska/SimpleImage/issues/165</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line"> </div>
<div class="line">        $boxText = imagettfbbox($size, $angle, $fontFile, $text);</div>
<div class="line">        <span class="keywordflow">if</span> (! $boxText) {</div>
<div class="line">            <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;Unable to load font file: $fontFile&quot;</span>, self::ERR_FONT_FILE);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        $boxWidth = abs($boxText[4] - $boxText[0]);</div>
<div class="line">        $boxHeight = abs($boxText[5] - $boxText[1]);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Calculate Offset referring to the edges of the image.</span></div>
<div class="line">        <span class="comment">// Just invert the value for bottom|right;</span></div>
<div class="line">        <span class="keywordflow">if</span> ($calculateOffsetFromEdge) {</div>
<div class="line">            <span class="keywordflow">if</span> (str_contains($anchor, <span class="stringliteral">&#39;bottom&#39;</span>)) {</div>
<div class="line">                $yOffset *= -1;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (str_contains($anchor, <span class="stringliteral">&#39;right&#39;</span>)) {</div>
<div class="line">                $xOffset *= -1;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Align the text font with the baseline.</span></div>
<div class="line">        <span class="comment">// I use $yOffset to inject the vertical alignment correction value.</span></div>
<div class="line">        <span class="keywordflow">if</span> ($baselineAlign) {</div>
<div class="line">            <span class="comment">// Create a temporary box to obtain the maximum height that this font can use.</span></div>
<div class="line">            $boxFull = imagettfbbox($size, $angle, $fontFile, <span class="stringliteral">&#39;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890&#39;</span>);</div>
<div class="line">            <span class="comment">// Based on the maximum height, the text is aligned.</span></div>
<div class="line">            <span class="keywordflow">if</span> (str_contains($anchor, <span class="stringliteral">&#39;bottom&#39;</span>)) {</div>
<div class="line">                $yOffset -= $boxFull[1];</div>
<div class="line">            } elseif (str_contains($anchor, <span class="stringliteral">&#39;top&#39;</span>)) {</div>
<div class="line">                $yOffset += abs($boxFull[5]) - $boxHeight;</div>
<div class="line">            } <span class="keywordflow">else</span> { <span class="comment">// center</span></div>
<div class="line">                $boxFullHeight = abs($boxFull[1]) + abs($boxFull[5]);</div>
<div class="line">                $yOffset += ($boxFullHeight / 2) - ($boxHeight / 2) - abs($boxFull[1]);</div>
<div class="line">            }</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="comment">// Prevents fonts rendered outside the box boundary from being cut.</span></div>
<div class="line">            <span class="comment">// Example: &#39;Scriptina&#39; font, some letters invade the space of the previous or subsequent letter.</span></div>
<div class="line">            $yOffset -= $boxText[1];</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Prevents fonts rendered outside the box boundary from being cut.</span></div>
<div class="line">        <span class="comment">// Example: &#39;Scriptina&#39; font, some letters invade the space of the previous or subsequent letter.</span></div>
<div class="line">        $xOffset -= $boxText[0];</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Determine position</span></div>
<div class="line">        <span class="keywordflow">switch</span>($anchor) {</div>
<div class="line">            <span class="keywordflow">case</span> <span class="stringliteral">&#39;top left&#39;</span>:</div>
<div class="line">                $x = $xOffset;</div>
<div class="line">                $y = $yOffset + $boxHeight;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <span class="stringliteral">&#39;top right&#39;</span>:</div>
<div class="line">                $x = $this-&gt;getWidth() - $boxWidth + $xOffset;</div>
<div class="line">                $y = $yOffset + $boxHeight;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <span class="stringliteral">&#39;top&#39;</span>:</div>
<div class="line">                $x = ($this-&gt;getWidth() / 2) - ($boxWidth / 2) + $xOffset;</div>
<div class="line">                $y = $yOffset + $boxHeight;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <span class="stringliteral">&#39;bottom left&#39;</span>:</div>
<div class="line">                $x = $xOffset;</div>
<div class="line">                $y = $this-&gt;getHeight() + $yOffset;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <span class="stringliteral">&#39;bottom right&#39;</span>:</div>
<div class="line">                $x = $this-&gt;getWidth() - $boxWidth + $xOffset;</div>
<div class="line">                $y = $this-&gt;getHeight() + $yOffset;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <span class="stringliteral">&#39;bottom&#39;</span>:</div>
<div class="line">                $x = ($this-&gt;getWidth() / 2) - ($boxWidth / 2) + $xOffset;</div>
<div class="line">                $y = $this-&gt;getHeight() + $yOffset;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <span class="stringliteral">&#39;left&#39;</span>:</div>
<div class="line">                $x = $xOffset;</div>
<div class="line">                $y = ($this-&gt;getHeight() / 2) - (($boxHeight / 2) - $boxHeight) + $yOffset;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <span class="stringliteral">&#39;right&#39;</span>:</div>
<div class="line">                $x = $this-&gt;getWidth() - $boxWidth + $xOffset;</div>
<div class="line">                $y = ($this-&gt;getHeight() / 2) - (($boxHeight / 2) - $boxHeight) + $yOffset;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">default</span>: <span class="comment">// center</span></div>
<div class="line">                $x = ($this-&gt;getWidth() / 2) - ($boxWidth / 2) + $xOffset;</div>
<div class="line">                $y = ($this-&gt;getHeight() / 2) - (($boxHeight / 2) - $boxHeight) + $yOffset;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        $x = (int) round($x);</div>
<div class="line">        $y = (int) round($y);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Pass the boundary back by reference</span></div>
<div class="line">        $boundary = [</div>
<div class="line">            <span class="stringliteral">&#39;x1&#39;</span> =&gt; $x + $boxText[0],</div>
<div class="line">            <span class="stringliteral">&#39;y1&#39;</span> =&gt; $y + $boxText[1] - $boxHeight, <span class="comment">// $y is the baseline, not the top!</span></div>
<div class="line">            <span class="stringliteral">&#39;x2&#39;</span> =&gt; $x + $boxWidth + $boxText[0],</div>
<div class="line">            <span class="stringliteral">&#39;y2&#39;</span> =&gt; $y + $boxText[1],</div>
<div class="line">            <span class="stringliteral">&#39;width&#39;</span> =&gt; $boxWidth,</div>
<div class="line">            <span class="stringliteral">&#39;height&#39;</span> =&gt; $boxHeight,</div>
<div class="line">        ];</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Text shadow</span></div>
<div class="line">        <span class="keywordflow">if</span> (is_array(<a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;shadow&#39;</span>])) {</div>
<div class="line">            imagettftext(</div>
<div class="line">                $this-&gt;image,</div>
<div class="line">                $size,</div>
<div class="line">                $angle,</div>
<div class="line">                $x + <a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;shadow&#39;</span>][<span class="charliteral">&#39;x&#39;</span>],</div>
<div class="line">                $y + <a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;shadow&#39;</span>][<span class="charliteral">&#39;y&#39;</span>],</div>
<div class="line">                $this-&gt;allocateColor(<a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;shadow&#39;</span>][<span class="stringliteral">&#39;color&#39;</span>]),</div>
<div class="line">                $fontFile,</div>
<div class="line">                $text</div>
<div class="line">            );</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Draw the text</span></div>
<div class="line">        imagettftext($this-&gt;image, $size, $angle, $x, $y, $color, $fontFile, $text);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> $this;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Adds text with a line break to the image.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @param  string  $text The desired text.</span></div>
<div class="line"><span class="comment">     * @param  array  $options</span></div>
<div class="line"><span class="comment">     *  An array of options.</span></div>
<div class="line"><span class="comment">     *     - fontFile* (string) - The TrueType (or compatible) font file to use.</span></div>
<div class="line"><span class="comment">     *     - size (integer) - The size of the font in pixels (default 12).</span></div>
<div class="line"><span class="comment">     *     - color (string|array) - The text color (default black).</span></div>
<div class="line"><span class="comment">     *     - anchor (string) - The anchor point: &#39;center&#39;, &#39;top&#39;, &#39;bottom&#39;, &#39;left&#39;, &#39;right&#39;, &#39;top left&#39;, &#39;top right&#39;, &#39;bottom left&#39;, &#39;bottom right&#39; (default &#39;center&#39;).</span></div>
<div class="line"><span class="comment">     *     - xOffset (integer) - The horizontal offset in pixels (default 0). Has no effect when anchor is &#39;center&#39;.</span></div>
<div class="line"><span class="comment">     *     - yOffset (integer) - The vertical offset in pixels (default 0). Has no effect when anchor is &#39;center&#39;.</span></div>
<div class="line"><span class="comment">     *     - shadow (array) - Text shadow params.</span></div>
<div class="line"><span class="comment">     *       - x* (integer) - Horizontal offset in pixels.</span></div>
<div class="line"><span class="comment">     *       - y* (integer) - Vertical offset in pixels.</span></div>
<div class="line"><span class="comment">     *       - color* (string|array) - The text shadow color.</span></div>
<div class="line"><span class="comment">     *     - $calculateOffsetFromEdge (bool) - Calculate offsets from the edge of the image (default false).</span></div>
<div class="line"><span class="comment">     *     - width (int) - Width of text box (default image width).</span></div>
<div class="line"><span class="comment">     *     - align (string) - How to align text: &#39;left&#39;, &#39;right&#39;, &#39;center&#39;, &#39;justify&#39; (default &#39;left&#39;).</span></div>
<div class="line"><span class="comment">     *     - leading (float) - Increase/decrease spacing between lines of text (default 0).</span></div>
<div class="line"><span class="comment">     *     - opacity (float) - The opacity level of the text 0-1 (default 1).</span></div>
<div class="line"><span class="comment">     * @return SimpleImage</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @throws Exception</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> textBox(<span class="keywordtype">string</span> $text, array <a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>): static</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// default width of image</span></div>
<div class="line">        $maxWidth = $this-&gt;getWidth();</div>
<div class="line">        <span class="comment">// Default options</span></div>
<div class="line">        <a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a> = array_merge([</div>
<div class="line">            <span class="stringliteral">&#39;fontFile&#39;</span> =&gt; <span class="keyword">null</span>,</div>
<div class="line">            <span class="stringliteral">&#39;size&#39;</span> =&gt; 12,</div>
<div class="line">            <span class="stringliteral">&#39;color&#39;</span> =&gt; <span class="stringliteral">&#39;black&#39;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;anchor&#39;</span> =&gt; <span class="stringliteral">&#39;center&#39;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;xOffset&#39;</span> =&gt; 0,</div>
<div class="line">            <span class="stringliteral">&#39;yOffset&#39;</span> =&gt; 0,</div>
<div class="line">            <span class="stringliteral">&#39;shadow&#39;</span> =&gt; <span class="keyword">null</span>,</div>
<div class="line">            <span class="stringliteral">&#39;calculateOffsetFromEdge&#39;</span> =&gt; <span class="keyword">false</span>,</div>
<div class="line">            <span class="stringliteral">&#39;width&#39;</span> =&gt; $maxWidth,</div>
<div class="line">            <span class="stringliteral">&#39;align&#39;</span> =&gt; <span class="stringliteral">&#39;left&#39;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;leading&#39;</span> =&gt; 0,</div>
<div class="line">            <span class="stringliteral">&#39;opacity&#39;</span> =&gt; 1,</div>
<div class="line">        ], <a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Extract and normalize options</span></div>
<div class="line">        $fontFile = <a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;fontFile&#39;</span>];</div>
<div class="line">        $fontSize = $fontSizePx = <a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;size&#39;</span>];</div>
<div class="line">        $fontSize = ($fontSize / 96) * 72; <span class="comment">// Convert px to pt (72pt per inch, 96px per inch)</span></div>
<div class="line">        $color = <a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;color&#39;</span>];</div>
<div class="line">        $anchor = <a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;anchor&#39;</span>];</div>
<div class="line">        $xOffset = <a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;xOffset&#39;</span>];</div>
<div class="line">        $yOffset = <a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;yOffset&#39;</span>];</div>
<div class="line">        $shadow = <a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;shadow&#39;</span>];</div>
<div class="line">        $calculateOffsetFromEdge = <a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;calculateOffsetFromEdge&#39;</span>];</div>
<div class="line">        $maxWidth = intval(<a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;width&#39;</span>]);</div>
<div class="line">        $leading = <a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;leading&#39;</span>];</div>
<div class="line">        $leading = self::keepWithin($leading, ($fontSizePx * -1), $leading);</div>
<div class="line">        $opacity = <a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;opacity&#39;</span>];</div>
<div class="line"> </div>
<div class="line">        $align = <a class="code" href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;align&#39;</span>];</div>
<div class="line">        <span class="keywordflow">if</span> ($align == <span class="stringliteral">&#39;right&#39;</span>) {</div>
<div class="line">            $align = <span class="stringliteral">&#39;top right&#39;</span>;</div>
<div class="line">        } elseif ($align == <span class="stringliteral">&#39;center&#39;</span>) {</div>
<div class="line">            $align = <span class="stringliteral">&#39;top&#39;</span>;</div>
<div class="line">        } elseif ($align == <span class="stringliteral">&#39;justify&#39;</span>) {</div>
<div class="line">            $align = <span class="stringliteral">&#39;justify&#39;</span>;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            $align = <span class="stringliteral">&#39;top left&#39;</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        [$lines, $isLastLine, $lastLineHeight] = self::textSeparateLines($text, $fontFile, $fontSize, $maxWidth);</div>
<div class="line"> </div>
<div class="line">        $maxHeight = (int) round(((is_countable($lines) ? count($lines) : 0) - 1) * ($fontSizePx * 1.2 + $leading) + $lastLineHeight);</div>
<div class="line"> </div>
<div class="line">        $imageText = <span class="keyword">new</span> SimpleImage();</div>
<div class="line">        $imageText-&gt;fromNew($maxWidth, $maxHeight);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Align left/center/right</span></div>
<div class="line">        <span class="keywordflow">if</span> ($align != <span class="stringliteral">&#39;justify&#39;</span>) {</div>
<div class="line">            <span class="keywordflow">foreach</span> ($lines as $key =&gt; $line) {</div>
<div class="line">                <span class="keywordflow">if</span> ($align == <span class="stringliteral">&#39;top&#39;</span>) {</div>
<div class="line">                    $line = trim($line);</div>
<div class="line">                } <span class="comment">// If is justify = &#39;center&#39;</span></div>
<div class="line">                $imageText-&gt;text($line, [<span class="stringliteral">&#39;fontFile&#39;</span> =&gt; $fontFile, <span class="stringliteral">&#39;size&#39;</span> =&gt; $fontSizePx, <span class="stringliteral">&#39;color&#39;</span> =&gt; $color, <span class="stringliteral">&#39;anchor&#39;</span> =&gt; $align, <span class="stringliteral">&#39;xOffset&#39;</span> =&gt; 0, <span class="stringliteral">&#39;yOffset&#39;</span> =&gt; $key * ($fontSizePx * 1.2 + $leading), <span class="stringliteral">&#39;shadow&#39;</span> =&gt; $shadow, <span class="stringliteral">&#39;calculateOffsetFromEdge&#39;</span> =&gt; <span class="keyword">true</span>]);</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Justify</span></div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="keywordflow">foreach</span> ($lines as $keyLine =&gt; $line) {</div>
<div class="line">                <span class="comment">// Check if there are spaces at the beginning of the sentence</span></div>
<div class="line">                $spaces = 0;</div>
<div class="line">                <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&quot;/^\s+/&quot;</span>, $line, $match)) {</div>
<div class="line">                    <span class="comment">// Count spaces</span></div>
<div class="line">                    $spaces = strlen($match[0]);</div>
<div class="line">                    $line = ltrim($line);</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                <span class="comment">// Separate words</span></div>
<div class="line">                $words = preg_split(<span class="stringliteral">&quot;/\s+/&quot;</span>, $line);</div>
<div class="line">                <span class="comment">// Include spaces with the first word</span></div>
<div class="line">                $words[0] = str_repeat(<span class="charliteral">&#39; &#39;</span>, $spaces).$words[0];</div>
<div class="line"> </div>
<div class="line">                <span class="comment">// Calculates the space occupied by all words</span></div>
<div class="line">                $wordsSize = [];</div>
<div class="line">                <span class="keywordflow">foreach</span> ($words as $key =&gt; $word) {</div>
<div class="line">                    $wordBox = imagettfbbox($fontSize, 0, $fontFile, $word);</div>
<div class="line">                    $wordWidth = abs($wordBox[4] - $wordBox[0]);</div>
<div class="line">                    $wordsSize[$key] = $wordWidth;</div>
<div class="line">                }</div>
<div class="line">                $wordsSizeTotal = array_sum($wordsSize);</div>
<div class="line"> </div>
<div class="line">                <span class="comment">// Calculates the required space between words</span></div>
<div class="line">                $countWords = count($words);</div>
<div class="line">                $wordSpacing = 0;</div>
<div class="line">                <span class="keywordflow">if</span> ($countWords &gt; 1) {</div>
<div class="line">                    $wordSpacing = ($maxWidth - $wordsSizeTotal) / ($countWords - 1);</div>
<div class="line">                    $wordSpacing = round($wordSpacing, 3);</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                $xOffsetJustify = 0;</div>
<div class="line">                <span class="keywordflow">foreach</span> ($words as $key =&gt; $word) {</div>
<div class="line">                    <span class="keywordflow">if</span> ($isLastLine[$keyLine]) {</div>
<div class="line">                        <span class="keywordflow">if</span> ($key &lt; (count($words) - 1)) {</div>
<div class="line">                            <span class="keywordflow">continue</span>;</div>
<div class="line">                        }</div>
<div class="line">                        $word = $line;</div>
<div class="line">                    }</div>
<div class="line">                    $imageText-&gt;text($word, [<span class="stringliteral">&#39;fontFile&#39;</span> =&gt; $fontFile, <span class="stringliteral">&#39;size&#39;</span> =&gt; $fontSizePx, <span class="stringliteral">&#39;color&#39;</span> =&gt; $color, <span class="stringliteral">&#39;anchor&#39;</span> =&gt; <span class="stringliteral">&#39;top left&#39;</span>, <span class="stringliteral">&#39;xOffset&#39;</span> =&gt; $xOffsetJustify, <span class="stringliteral">&#39;yOffset&#39;</span> =&gt; $keyLine * ($fontSizePx * 1.2 + $leading), <span class="stringliteral">&#39;shadow&#39;</span> =&gt; $shadow, <span class="stringliteral">&#39;calculateOffsetFromEdge&#39;</span> =&gt; <span class="keyword">true</span>]</div>
<div class="line">                    );</div>
<div class="line">                    <span class="comment">// Calculate offset for next word</span></div>
<div class="line">                    $xOffsetJustify += $wordsSize[$key] + $wordSpacing;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        $this-&gt;overlay($imageText, $anchor, $opacity, $xOffset, $yOffset, $calculateOffsetFromEdge);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> $this;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Receives a text and breaks into LINES.</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">private</span> <span class="keyword">function</span> textSeparateLines(<span class="keywordtype">string</span> $text, <span class="keywordtype">string</span> $fontFile, <span class="keywordtype">int</span> $fontSize, <span class="keywordtype">int</span> $maxWidth): array</div>
<div class="line">    {</div>
<div class="line">        $lines = [];</div>
<div class="line">        $words = self::textSeparateWords($text);</div>
<div class="line">        $countWords = count($words) - 1;</div>
<div class="line">        $lines[0] = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line">        $lineKey = 0;</div>
<div class="line">        $isLastLine = [];</div>
<div class="line">        <span class="keywordflow">for</span> (<a class="code" href="widget-edit_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a> = 0; <a class="code" href="widget-edit_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a> &lt; $countWords; <a class="code" href="widget-edit_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a>++) {</div>
<div class="line">            $word = $words[<a class="code" href="widget-edit_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a>];</div>
<div class="line">            $isLastLine[$lineKey] = <span class="keyword">false</span>;</div>
<div class="line">            <span class="keywordflow">if</span> ($word === PHP_EOL) {</div>
<div class="line">                $isLastLine[$lineKey] = <span class="keyword">true</span>;</div>
<div class="line">                $lineKey++;</div>
<div class="line">                $lines[$lineKey] = <span class="stringliteral">&#39;&#39;</span>;</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            }</div>
<div class="line">            $lineBox = imagettfbbox($fontSize, 0, $fontFile, $lines[$lineKey].$word);</div>
<div class="line">            <span class="keywordflow">if</span> (abs($lineBox[4] - $lineBox[0]) &lt; $maxWidth) {</div>
<div class="line">                $lines[$lineKey] .= $word.<span class="charliteral">&#39; &#39;</span>;</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                $lineKey++;</div>
<div class="line">                $lines[$lineKey] = $word.<span class="charliteral">&#39; &#39;</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        $isLastLine[$lineKey] = <span class="keyword">true</span>;</div>
<div class="line">        <span class="comment">// Exclude space of right</span></div>
<div class="line">        $lines = array_map(<span class="stringliteral">&#39;rtrim&#39;</span>, $lines);</div>
<div class="line">        <span class="comment">// Calculate height of last line</span></div>
<div class="line">        $boxFull = imagettfbbox($fontSize, 0, $fontFile, <span class="stringliteral">&#39;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890&#39;</span>);</div>
<div class="line">        $lineBox = imagettfbbox($fontSize, 0, $fontFile, $lines[$lineKey]);</div>
<div class="line">        <span class="comment">// Height of last line = ascender of $boxFull + descender of $lineBox</span></div>
<div class="line">        $lastLineHeight = abs($lineBox[1]) + abs($boxFull[5]);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> [$lines, $isLastLine, $lastLineHeight];</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Receives a text and breaks into WORD / SPACE / NEW LINE.</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">private</span> <span class="keyword">function</span> textSeparateWords(<span class="keywordtype">string</span> $text): array</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Normalizes line break</span></div>
<div class="line">        $text = strval(preg_replace(<span class="stringliteral">&#39;/(\r\n|\n|\r)/&#39;</span>, PHP_EOL, $text));</div>
<div class="line">        $text = explode(PHP_EOL, $text);</div>
<div class="line">        $newText = [];</div>
<div class="line">        <span class="keywordflow">foreach</span> ($text as $line) {</div>
<div class="line">            $newText = array_merge($newText, explode(<span class="charliteral">&#39; &#39;</span>, $line), [PHP_EOL]);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> $newText;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Creates a thumbnail image. This function attempts to get the image as close to the provided</span></div>
<div class="line"><span class="comment">     * dimensions as possible, then crops the remaining overflow to force the desired size. Useful</span></div>
<div class="line"><span class="comment">     * for generating thumbnail images.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @param  int  $width The thumbnail width.</span></div>
<div class="line"><span class="comment">     * @param  int  $height The thumbnail height.</span></div>
<div class="line"><span class="comment">     * @param  string  $anchor The anchor point: &#39;center&#39;, &#39;top&#39;, &#39;bottom&#39;, &#39;left&#39;, &#39;right&#39;, &#39;top left&#39;, &#39;top right&#39;, &#39;bottom left&#39;, &#39;bottom right&#39; (default &#39;center&#39;).</span></div>
<div class="line"><span class="comment">     * @return SimpleImage</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> <a name="a5"></a><a class="code" href="blog-edit_8php.html#afe81f9052fdaa7785564b7439d898650">thumbnail</a>(<span class="keywordtype">int</span> $width, <span class="keywordtype">int</span> $height, <span class="keywordtype">string</span> $anchor = <span class="stringliteral">&#39;center&#39;</span>): SimpleImage|static</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Determine aspect ratios</span></div>
<div class="line">        $currentRatio = $this-&gt;getHeight() / $this-&gt;getWidth();</div>
<div class="line">        $targetRatio = $height / $width;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Fit to height/width</span></div>
<div class="line">        <span class="keywordflow">if</span> ($targetRatio &gt; $currentRatio) {</div>
<div class="line">            $this-&gt;resize(<span class="keyword">null</span>, $height);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            $this-&gt;resize($width);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">switch</span>($anchor) {</div>
<div class="line">            <span class="keywordflow">case</span> <span class="stringliteral">&#39;top&#39;</span>:</div>
<div class="line">                $x1 = floor(($this-&gt;getWidth() / 2) - ($width / 2));</div>
<div class="line">                $x2 = $width + $x1;</div>
<div class="line">                $y1 = 0;</div>
<div class="line">                $y2 = $height;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <span class="stringliteral">&#39;bottom&#39;</span>:</div>
<div class="line">                $x1 = floor(($this-&gt;getWidth() / 2) - ($width / 2));</div>
<div class="line">                $x2 = $width + $x1;</div>
<div class="line">                $y1 = $this-&gt;getHeight() - $height;</div>
<div class="line">                $y2 = $this-&gt;getHeight();</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <span class="stringliteral">&#39;left&#39;</span>:</div>
<div class="line">                $x1 = 0;</div>
<div class="line">                $x2 = $width;</div>
<div class="line">                $y1 = floor(($this-&gt;getHeight() / 2) - ($height / 2));</div>
<div class="line">                $y2 = $height + $y1;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <span class="stringliteral">&#39;right&#39;</span>:</div>
<div class="line">                $x1 = $this-&gt;getWidth() - $width;</div>
<div class="line">                $x2 = $this-&gt;getWidth();</div>
<div class="line">                $y1 = floor(($this-&gt;getHeight() / 2) - ($height / 2));</div>
<div class="line">                $y2 = $height + $y1;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <span class="stringliteral">&#39;top left&#39;</span>:</div>
<div class="line">                $x1 = 0;</div>
<div class="line">                $x2 = $width;</div>
<div class="line">                $y1 = 0;</div>
<div class="line">                $y2 = $height;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <span class="stringliteral">&#39;top right&#39;</span>:</div>
<div class="line">                $x1 = $this-&gt;getWidth() - $width;</div>
<div class="line">                $x2 = $this-&gt;getWidth();</div>
<div class="line">                $y1 = 0;</div>
<div class="line">                $y2 = $height;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <span class="stringliteral">&#39;bottom left&#39;</span>:</div>
<div class="line">                $x1 = 0;</div>
<div class="line">                $x2 = $width;</div>
<div class="line">                $y1 = $this-&gt;getHeight() - $height;</div>
<div class="line">                $y2 = $this-&gt;getHeight();</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <span class="stringliteral">&#39;bottom right&#39;</span>:</div>
<div class="line">                $x1 = $this-&gt;getWidth() - $width;</div>
<div class="line">                $x2 = $this-&gt;getWidth();</div>
<div class="line">                $y1 = $this-&gt;getHeight() - $height;</div>
<div class="line">                $y2 = $this-&gt;getHeight();</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">default</span>:</div>
<div class="line">                $x1 = floor(($this-&gt;getWidth() / 2) - ($width / 2));</div>
<div class="line">                $x2 = $width + $x1;</div>
<div class="line">                $y1 = floor(($this-&gt;getHeight() / 2) - ($height / 2));</div>
<div class="line">                $y2 = $height + $y1;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Return the cropped thumbnail image</span></div>
<div class="line">        <span class="keywordflow">return</span> $this-&gt;crop($x1, $y1, $x2, $y2);</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    //////////////////////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment"></span>    <span class="comment">// Drawing</span><span class="comment"></span></div>
<div class="line"><span class="comment">    //////////////////////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment"></span><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Draws an arc.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @param  int  $x The x coordinate of the arc&#39;s center.</span></div>
<div class="line"><span class="comment">     * @param  int  $y The y coordinate of the arc&#39;s center.</span></div>
<div class="line"><span class="comment">     * @param  int  $width The width of the arc.</span></div>
<div class="line"><span class="comment">     * @param  int  $height The height of the arc.</span></div>
<div class="line"><span class="comment">     * @param  int  $start The start of the arc in degrees.</span></div>
<div class="line"><span class="comment">     * @param  int  $end The end of the arc in degrees.</span></div>
<div class="line"><span class="comment">     * @param  string|array  $color The arc color.</span></div>
<div class="line"><span class="comment">     * @param  int|string  $thickness Line thickness in pixels or &#39;filled&#39; (default 1).</span></div>
<div class="line"><span class="comment">     * @return SimpleImage</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @throws Exception</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> arc(<span class="keywordtype">int</span> $x, <span class="keywordtype">int</span> $y, <span class="keywordtype">int</span> $width, <span class="keywordtype">int</span> $height, <span class="keywordtype">int</span> $start, <span class="keywordtype">int</span> $end, <span class="keywordtype">string</span>|array $color, <span class="keywordtype">int</span>|<span class="keywordtype">string</span> $thickness = 1): static</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Allocate the color</span></div>
<div class="line">        $tempColor = $this-&gt;allocateColor($color);</div>
<div class="line">        imagesetthickness($this-&gt;image, 1);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Draw an arc</span></div>
<div class="line">        <span class="keywordflow">if</span> ($thickness === <span class="stringliteral">&#39;filled&#39;</span>) {</div>
<div class="line">            imagefilledarc($this-&gt;image, $x, $y, $width, $height, $start, $end, $tempColor, IMG_ARC_PIE);</div>
<div class="line">        } elseif ($thickness === 1) {</div>
<div class="line">            imagearc($this-&gt;image, $x, $y, $width, $height, $start, $end, $tempColor);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="comment">// New temp image</span></div>
<div class="line">            $tempImage = <span class="keyword">new</span> SimpleImage();</div>
<div class="line">            $tempImage-&gt;fromNew($this-&gt;getWidth(), $this-&gt;getHeight());</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Draw a large ellipse filled with $color (+$thickness pixels)</span></div>
<div class="line">            $tempColor = $tempImage-&gt;allocateColor($color);</div>
<div class="line">            imagefilledarc($tempImage-&gt;image, $x, $y, $width + $thickness, $height + $thickness, $start, $end, $tempColor, IMG_ARC_PIE);</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Draw a smaller ellipse filled with red|blue (-$thickness pixels)</span></div>
<div class="line">            $tempColor = (self::normalizeColor($color)[<span class="stringliteral">&#39;red&#39;</span>] == 255) ? <span class="stringliteral">&#39;blue&#39;</span> : <span class="stringliteral">&#39;red&#39;</span>;</div>
<div class="line">            $tempColor = $tempImage-&gt;allocateColor($tempColor);</div>
<div class="line">            imagefilledarc($tempImage-&gt;image, $x, $y, $width - $thickness, $height - $thickness, $start, $end, $tempColor, IMG_ARC_PIE);</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Replace the color of the smaller ellipse with &#39;transparent&#39;</span></div>
<div class="line">            $tempImage-&gt;excludeInsideColor($x, $y, $color);</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Apply the temp image</span></div>
<div class="line">            $this-&gt;overlay($tempImage);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> $this;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Draws a border around the image.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @param  string|array  $color The border color.</span></div>
<div class="line"><span class="comment">     * @param  int  $thickness The thickness of the border (default 1).</span></div>
<div class="line"><span class="comment">     * @return SimpleImage</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @throws Exception</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> border(<span class="keywordtype">string</span>|array $color, <span class="keywordtype">int</span> $thickness = 1): static</div>
<div class="line">    {</div>
<div class="line">        $x1 = -1;</div>
<div class="line">        $y1 = 0;</div>
<div class="line">        $x2 = $this-&gt;getWidth();</div>
<div class="line">        $y2 = $this-&gt;getHeight() - 1;</div>
<div class="line"> </div>
<div class="line">        $color = $this-&gt;allocateColor($color);</div>
<div class="line">        imagesetthickness($this-&gt;image, $thickness * 2);</div>
<div class="line">        imagerectangle($this-&gt;image, $x1, $y1, $x2, $y2, $color);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> $this;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Draws a single pixel dot.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @param  int  $x The x coordinate of the dot.</span></div>
<div class="line"><span class="comment">     * @param  int  $y The y coordinate of the dot.</span></div>
<div class="line"><span class="comment">     * @param  string|array  $color The dot color.</span></div>
<div class="line"><span class="comment">     * @return SimpleImage</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @throws Exception</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> dot(<span class="keywordtype">int</span> $x, <span class="keywordtype">int</span> $y, <span class="keywordtype">string</span>|array $color): static</div>
<div class="line">    {</div>
<div class="line">        $color = $this-&gt;allocateColor($color);</div>
<div class="line">        imagesetpixel($this-&gt;image, $x, $y, $color);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> $this;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Draws an ellipse.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @param  int  $x The x coordinate of the center.</span></div>
<div class="line"><span class="comment">     * @param  int  $y The y coordinate of the center.</span></div>
<div class="line"><span class="comment">     * @param  int  $width The ellipse width.</span></div>
<div class="line"><span class="comment">     * @param  int  $height The ellipse height.</span></div>
<div class="line"><span class="comment">     * @param  string|array  $color The ellipse color.</span></div>
<div class="line"><span class="comment">     * @param  int|array  $thickness Line thickness in pixels or &#39;filled&#39; (default 1).</span></div>
<div class="line"><span class="comment">     * @return SimpleImage</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @throws Exception</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> ellipse(<span class="keywordtype">int</span> $x, <span class="keywordtype">int</span> $y, <span class="keywordtype">int</span> $width, <span class="keywordtype">int</span> $height, <span class="keywordtype">string</span>|array $color, <span class="keywordtype">int</span>|array $thickness = 1): static</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Allocate the color</span></div>
<div class="line">        $tempColor = $this-&gt;allocateColor($color);</div>
<div class="line">        imagesetthickness($this-&gt;image, 1);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Draw an ellipse</span></div>
<div class="line">        <span class="keywordflow">if</span> ($thickness == <span class="stringliteral">&#39;filled&#39;</span>) {</div>
<div class="line">            imagefilledellipse($this-&gt;image, $x, $y, $width, $height, $tempColor);</div>
<div class="line">        } elseif ($thickness === 1) {</div>
<div class="line">            imageellipse($this-&gt;image, $x, $y, $width, $height, $tempColor);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="comment">// New temp image</span></div>
<div class="line">            $tempImage = <span class="keyword">new</span> SimpleImage();</div>
<div class="line">            $tempImage-&gt;fromNew($this-&gt;getWidth(), $this-&gt;getHeight());</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Draw a large ellipse filled with $color (+$thickness pixels)</span></div>
<div class="line">            $tempColor = $tempImage-&gt;allocateColor($color);</div>
<div class="line">            imagefilledellipse($tempImage-&gt;image, $x, $y, $width + $thickness, $height + $thickness, $tempColor);</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Draw a smaller ellipse filled with red|blue (-$thickness pixels)</span></div>
<div class="line">            $tempColor = (self::normalizeColor($color)[<span class="stringliteral">&#39;red&#39;</span>] == 255) ? <span class="stringliteral">&#39;blue&#39;</span> : <span class="stringliteral">&#39;red&#39;</span>;</div>
<div class="line">            $tempColor = $tempImage-&gt;allocateColor($tempColor);</div>
<div class="line">            imagefilledellipse($tempImage-&gt;image, $x, $y, $width - $thickness, $height - $thickness, $tempColor);</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Replace the color of the smaller ellipse with &#39;transparent&#39;</span></div>
<div class="line">            $tempImage-&gt;excludeInsideColor($x, $y, $color);</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Apply the temp image</span></div>
<div class="line">            $this-&gt;overlay($tempImage);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> $this;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Fills the image with a solid color.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @param  string|array  $color The fill color.</span></div>
<div class="line"><span class="comment">     * @return SimpleImage</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @throws Exception</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> fill(<span class="keywordtype">string</span>|array $color): static</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Draw a filled rectangle over the entire image</span></div>
<div class="line">        $this-&gt;rectangle(0, 0, $this-&gt;getWidth(), $this-&gt;getHeight(), <span class="stringliteral">&#39;white&#39;</span>, <span class="stringliteral">&#39;filled&#39;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Now flood it with the appropriate color</span></div>
<div class="line">        $color = $this-&gt;allocateColor($color);</div>
<div class="line">        imagefill($this-&gt;image, 0, 0, $color);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> $this;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Draws a line.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @param  int  $x1 The x coordinate for the first point.</span></div>
<div class="line"><span class="comment">     * @param  int  $y1 The y coordinate for the first point.</span></div>
<div class="line"><span class="comment">     * @param  int  $x2 The x coordinate for the second point.</span></div>
<div class="line"><span class="comment">     * @param  int  $y2 The y coordinate for the second point.</span></div>
<div class="line"><span class="comment">     * @param  string|array  $color The line color.</span></div>
<div class="line"><span class="comment">     * @param  int  $thickness The line thickness (default 1).</span></div>
<div class="line"><span class="comment">     * @return SimpleImage</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @throws Exception</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> line(<span class="keywordtype">int</span> $x1, <span class="keywordtype">int</span> $y1, <span class="keywordtype">int</span> $x2, <span class="keywordtype">int</span> $y2, <span class="keywordtype">string</span>|array $color, <span class="keywordtype">int</span> $thickness = 1): static</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Allocate the color</span></div>
<div class="line">        $color = $this-&gt;allocateColor($color);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Draw a line</span></div>
<div class="line">        imagesetthickness($this-&gt;image, $thickness);</div>
<div class="line">        imageline($this-&gt;image, $x1, $y1, $x2, $y2, $color);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> $this;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Draws a polygon.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @param  array  $vertices</span></div>
<div class="line"><span class="comment">     *    The polygon&#39;s vertices in an array of x/y arrays.</span></div>
<div class="line"><span class="comment">     *    Example:</span></div>
<div class="line"><span class="comment">     *        [</span></div>
<div class="line"><span class="comment">     *            [&#39;x&#39; =&gt; x1, &#39;y&#39; =&gt; y1],</span></div>
<div class="line"><span class="comment">     *            [&#39;x&#39; =&gt; x2, &#39;y&#39; =&gt; y2],</span></div>
<div class="line"><span class="comment">     *            [&#39;x&#39; =&gt; xN, &#39;y&#39; =&gt; yN]</span></div>
<div class="line"><span class="comment">     *        ]</span></div>
<div class="line"><span class="comment">     * @param  string|array  $color The polygon color.</span></div>
<div class="line"><span class="comment">     * @param  string|int|array  $thickness Line thickness in pixels or &#39;filled&#39; (default 1).</span></div>
<div class="line"><span class="comment">     * @return SimpleImage</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @throws Exception</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> polygon(array $vertices, <span class="keywordtype">string</span>|array $color, <span class="keywordtype">string</span>|<span class="keywordtype">int</span>|array $thickness = 1): static</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Allocate the color</span></div>
<div class="line">        $color = $this-&gt;allocateColor($color);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Convert [[&#39;x&#39; =&gt; x1, &#39;y&#39; =&gt; x1], [&#39;x&#39; =&gt; x1, &#39;y&#39; =&gt; y2], ...] to [x1, y1, x2, y2, ...]</span></div>
<div class="line">        $points = [];</div>
<div class="line">        <span class="keywordflow">foreach</span> ($vertices as $vals) {</div>
<div class="line">            $points[] = $vals[<span class="charliteral">&#39;x&#39;</span>];</div>
<div class="line">            $points[] = $vals[<span class="charliteral">&#39;y&#39;</span>];</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Draw a polygon</span></div>
<div class="line">        <span class="keywordflow">if</span> ($thickness == <span class="stringliteral">&#39;filled&#39;</span>) {</div>
<div class="line">            imagesetthickness($this-&gt;image, 1);</div>
<div class="line">            imagefilledpolygon($this-&gt;image, $points, count($vertices), $color);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            imagesetthickness($this-&gt;image, $thickness);</div>
<div class="line">            imagepolygon($this-&gt;image, $points, count($vertices), $color);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> $this;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Draws a rectangle.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @param  int  $x1 The upper left x coordinate.</span></div>
<div class="line"><span class="comment">     * @param  int  $y1 The upper left y coordinate.</span></div>
<div class="line"><span class="comment">     * @param  int  $x2 The bottom right x coordinate.</span></div>
<div class="line"><span class="comment">     * @param  int  $y2 The bottom right y coordinate.</span></div>
<div class="line"><span class="comment">     * @param  string|array  $color The rectangle color.</span></div>
<div class="line"><span class="comment">     * @param  string|int|array  $thickness Line thickness in pixels or &#39;filled&#39; (default 1).</span></div>
<div class="line"><span class="comment">     * @return SimpleImage</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @throws Exception</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> rectangle(<span class="keywordtype">int</span> $x1, <span class="keywordtype">int</span> $y1, <span class="keywordtype">int</span> $x2, <span class="keywordtype">int</span> $y2, <span class="keywordtype">string</span>|array $color, <span class="keywordtype">string</span>|<span class="keywordtype">int</span>|array $thickness = 1): static</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Allocate the color</span></div>
<div class="line">        $color = $this-&gt;allocateColor($color);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Draw a rectangle</span></div>
<div class="line">        <span class="keywordflow">if</span> ($thickness == <span class="stringliteral">&#39;filled&#39;</span>) {</div>
<div class="line">            imagesetthickness($this-&gt;image, 1);</div>
<div class="line">            imagefilledrectangle($this-&gt;image, $x1, $y1, $x2, $y2, $color);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            imagesetthickness($this-&gt;image, $thickness);</div>
<div class="line">            imagerectangle($this-&gt;image, $x1, $y1, $x2, $y2, $color);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> $this;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Draws a rounded rectangle.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @param  int  $x1 The upper left x coordinate.</span></div>
<div class="line"><span class="comment">     * @param  int  $y1 The upper left y coordinate.</span></div>
<div class="line"><span class="comment">     * @param  int  $x2 The bottom right x coordinate.</span></div>
<div class="line"><span class="comment">     * @param  int  $y2 The bottom right y coordinate.</span></div>
<div class="line"><span class="comment">     * @param  int  $radius The border radius in pixels.</span></div>
<div class="line"><span class="comment">     * @param  string|array  $color The rectangle color.</span></div>
<div class="line"><span class="comment">     * @param  string|int|array  $thickness Line thickness in pixels or &#39;filled&#39; (default 1).</span></div>
<div class="line"><span class="comment">     * @return SimpleImage</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @throws Exception</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> roundedRectangle(<span class="keywordtype">int</span> $x1, <span class="keywordtype">int</span> $y1, <span class="keywordtype">int</span> $x2, <span class="keywordtype">int</span> $y2, <span class="keywordtype">int</span> $radius, <span class="keywordtype">string</span>|array $color, <span class="keywordtype">string</span>|<span class="keywordtype">int</span>|array $thickness = 1): static</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> ($thickness == <span class="stringliteral">&#39;filled&#39;</span>) {</div>
<div class="line">            <span class="comment">// Draw the filled rectangle without edges</span></div>
<div class="line">            $this-&gt;rectangle($x1 + $radius + 1, $y1, $x2 - $radius - 1, $y2, $color, <span class="stringliteral">&#39;filled&#39;</span>);</div>
<div class="line">            $this-&gt;rectangle($x1, $y1 + $radius + 1, $x1 + $radius, $y2 - $radius - 1, $color, <span class="stringliteral">&#39;filled&#39;</span>);</div>
<div class="line">            $this-&gt;rectangle($x2 - $radius, $y1 + $radius + 1, $x2, $y2 - $radius - 1, $color, <span class="stringliteral">&#39;filled&#39;</span>);</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Fill in the edges with arcs</span></div>
<div class="line">            $this-&gt;arc($x1 + $radius, $y1 + $radius, $radius * 2, $radius * 2, 180, 270, $color, <span class="stringliteral">&#39;filled&#39;</span>);</div>
<div class="line">            $this-&gt;arc($x2 - $radius, $y1 + $radius, $radius * 2, $radius * 2, 270, 360, $color, <span class="stringliteral">&#39;filled&#39;</span>);</div>
<div class="line">            $this-&gt;arc($x1 + $radius, $y2 - $radius, $radius * 2, $radius * 2, 90, 180, $color, <span class="stringliteral">&#39;filled&#39;</span>);</div>
<div class="line">            $this-&gt;arc($x2 - $radius, $y2 - $radius, $radius * 2, $radius * 2, 360, 90, $color, <span class="stringliteral">&#39;filled&#39;</span>);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            $offset = $thickness / 2;</div>
<div class="line">            $x1 -= $offset;</div>
<div class="line">            $x2 += $offset;</div>
<div class="line">            $y1 -= $offset;</div>
<div class="line">            $y2 += $offset;</div>
<div class="line">            $radius = self::keepWithin($radius, 0, min(($x2 - $x1) / 2, ($y2 - $y1) / 2) - 1);</div>
<div class="line">            $radius = (int) floor($radius);</div>
<div class="line">            $thickness = self::keepWithin($thickness, 1, min(($x2 - $x1) / 2, ($y2 - $y1) / 2));</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// New temp image</span></div>
<div class="line">            $tempImage = <span class="keyword">new</span> SimpleImage();</div>
<div class="line">            $tempImage-&gt;fromNew($this-&gt;getWidth(), $this-&gt;getHeight());</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Draw a large rectangle filled with $color</span></div>
<div class="line">            $tempImage-&gt;roundedRectangle($x1, $y1, $x2, $y2, $radius, $color, <span class="stringliteral">&#39;filled&#39;</span>);</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Draw a smaller rectangle filled with red|blue (-$thickness pixels on each side)</span></div>
<div class="line">            $tempColor = (self::normalizeColor($color)[<span class="stringliteral">&#39;red&#39;</span>] == 255) ? <span class="stringliteral">&#39;blue&#39;</span> : <span class="stringliteral">&#39;red&#39;</span>;</div>
<div class="line">            $radius = $radius - $thickness;</div>
<div class="line">            $radius = self::keepWithin($radius, 0, $radius);</div>
<div class="line">            $tempImage-&gt;roundedRectangle(</div>
<div class="line">                $x1 + $thickness,</div>
<div class="line">                $y1 + $thickness,</div>
<div class="line">                $x2 - $thickness,</div>
<div class="line">                $y2 - $thickness,</div>
<div class="line">                $radius,</div>
<div class="line">                $tempColor,</div>
<div class="line">                <span class="stringliteral">&#39;filled&#39;</span></div>
<div class="line">            );</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Replace the color of the smaller rectangle with &#39;transparent&#39;</span></div>
<div class="line">            $tempImage-&gt;excludeInsideColor(($x2 + $x1) / 2, ($y2 + $y1) / 2, $color);</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Apply the temp image</span></div>
<div class="line">            $this-&gt;overlay($tempImage);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> $this;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Exclude inside color.</span></div>
<div class="line"><span class="comment">     * Used for roundedRectangle(), ellipse() and arc()</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @param  int  $x certer x of rectangle.</span></div>
<div class="line"><span class="comment">     * @param  int  $y certer y of rectangle.</span></div>
<div class="line"><span class="comment">     * @param  string|array  $borderColor The color of border.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @throws Exception</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">private</span> <span class="keyword">function</span> excludeInsideColor(<span class="keywordtype">int</span> $x, <span class="keywordtype">int</span> $y, <span class="keywordtype">string</span>|array $borderColor): static</div>
<div class="line">    {</div>
<div class="line">        $borderColor = $this-&gt;allocateColor($borderColor);</div>
<div class="line">        $transparent = $this-&gt;allocateColor(<span class="stringliteral">&#39;transparent&#39;</span>);</div>
<div class="line">        imagefilltoborder($this-&gt;image, $x, $y, $borderColor, $transparent);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> $this;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    //////////////////////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment"></span>    <span class="comment">// Filters</span><span class="comment"></span></div>
<div class="line"><span class="comment">    //////////////////////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment"></span><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Applies the blur filter.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @param  string  $type The blur algorithm to use: &#39;selective&#39;, &#39;gaussian&#39; (default &#39;gaussian&#39;).</span></div>
<div class="line"><span class="comment">     * @param  int  $passes The number of time to apply the filter, enhancing the effect (default 1).</span></div>
<div class="line"><span class="comment">     * @return SimpleImage</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> blur(<span class="keywordtype">string</span> <a name="a6"></a><a class="code" href="message-fetch_8php.html#a9a4a6fba2208984cabb3afacadf33919">$type</a> = <span class="stringliteral">&#39;selective&#39;</span>, <span class="keywordtype">int</span> $passes = 1): static</div>
<div class="line">    {</div>
<div class="line">        $filter = <a class="code" href="message-fetch_8php.html#a9a4a6fba2208984cabb3afacadf33919">$type</a> === <span class="stringliteral">&#39;gaussian&#39;</span> ? IMG_FILTER_GAUSSIAN_BLUR : IMG_FILTER_SELECTIVE_BLUR;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (<a class="code" href="widget-edit_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a> = 0; <a class="code" href="widget-edit_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a> &lt; $passes; <a class="code" href="widget-edit_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a>++) {</div>
<div class="line">            imagefilter($this-&gt;image, $filter);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> $this;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Applies the brightness filter to brighten the image.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @param  int  $percentage Percentage to brighten the image (0 - 100).</span></div>
<div class="line"><span class="comment">     * @return SimpleImage</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> brighten(<span class="keywordtype">int</span> $percentage): static</div>
<div class="line">    {</div>
<div class="line">        $percentage = self::keepWithin(255 * $percentage / 100, 0, 255);</div>
<div class="line"> </div>
<div class="line">        imagefilter($this-&gt;image, IMG_FILTER_BRIGHTNESS, $percentage);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> $this;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Applies the colorize filter.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @param  string|array  $color The filter color.</span></div>
<div class="line"><span class="comment">     * @return SimpleImage</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @throws Exception</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> colorize(<span class="keywordtype">string</span>|array $color): static</div>
<div class="line">    {</div>
<div class="line">        $color = self::normalizeColor($color);</div>
<div class="line"> </div>
<div class="line">        imagefilter(</div>
<div class="line">            $this-&gt;image,</div>
<div class="line">            IMG_FILTER_COLORIZE,</div>
<div class="line">            $color[<span class="stringliteral">&#39;red&#39;</span>],</div>
<div class="line">            $color[<span class="stringliteral">&#39;green&#39;</span>],</div>
<div class="line">            $color[<span class="stringliteral">&#39;blue&#39;</span>],</div>
<div class="line">            127 - ($color[<span class="stringliteral">&#39;alpha&#39;</span>] * 127)</div>
<div class="line">        );</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> $this;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Applies the contrast filter.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @param  int  $percentage Percentage to adjust (-100 - 100).</span></div>
<div class="line"><span class="comment">     * @return SimpleImage</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> contrast(<span class="keywordtype">int</span> $percentage): static</div>
<div class="line">    {</div>
<div class="line">        imagefilter($this-&gt;image, IMG_FILTER_CONTRAST, self::keepWithin($percentage, -100, 100));</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> $this;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Applies the brightness filter to darken the image.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @param  int  $percentage Percentage to darken the image (0 - 100).</span></div>
<div class="line"><span class="comment">     * @return SimpleImage</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> darken(<span class="keywordtype">int</span> $percentage): static</div>
<div class="line">    {</div>
<div class="line">        $percentage = self::keepWithin(255 * $percentage / 100, 0, 255);</div>
<div class="line"> </div>
<div class="line">        imagefilter($this-&gt;image, IMG_FILTER_BRIGHTNESS, -$percentage);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> $this;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Applies the desaturate (grayscale) filter.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @return SimpleImage</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> desaturate(): static</div>
<div class="line">    {</div>
<div class="line">        imagefilter($this-&gt;image, IMG_FILTER_GRAYSCALE);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> $this;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Applies the edge detect filter.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @return SimpleImage</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> edgeDetect(): static</div>
<div class="line">    {</div>
<div class="line">        imagefilter($this-&gt;image, IMG_FILTER_EDGEDETECT);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> $this;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Applies the emboss filter.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @return SimpleImage</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> emboss(): static</div>
<div class="line">    {</div>
<div class="line">        imagefilter($this-&gt;image, IMG_FILTER_EMBOSS);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> $this;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Inverts the image&#39;s colors.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @return SimpleImage</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> invert(): static</div>
<div class="line">    {</div>
<div class="line">        imagefilter($this-&gt;image, IMG_FILTER_NEGATE);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> $this;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Changes the image&#39;s opacity level.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @param  float  $opacity The desired opacity level (0 - 1).</span></div>
<div class="line"><span class="comment">     * @return SimpleImage</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @throws Exception</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> opacity(<span class="keywordtype">float</span> $opacity): static</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Create a transparent image</span></div>
<div class="line">        $newImage = <span class="keyword">new</span> SimpleImage();</div>
<div class="line">        $newImage-&gt;fromNew($this-&gt;getWidth(), $this-&gt;getHeight());</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Copy the current image (with opacity) onto the transparent image</span></div>
<div class="line">        self::imageCopyMergeAlpha(</div>
<div class="line">            $newImage-&gt;image,</div>
<div class="line">            $this-&gt;image,</div>
<div class="line">            0, 0,</div>
<div class="line">            0, 0,</div>
<div class="line">            $this-&gt;getWidth(),</div>
<div class="line">            $this-&gt;getHeight(),</div>
<div class="line">            (<span class="keywordtype">int</span>) round(self::keepWithin($opacity, 0, 1) * 100)</div>
<div class="line">        );</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> $this;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Applies the pixelate filter.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @param  int  $size The size of the blocks in pixels (default 10).</span></div>
<div class="line"><span class="comment">     * @return SimpleImage</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> pixelate(<span class="keywordtype">int</span> $size = 10): static</div>
<div class="line">    {</div>
<div class="line">        imagefilter($this-&gt;image, IMG_FILTER_PIXELATE, $size, <span class="keyword">true</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> $this;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Simulates a sepia effect by desaturating the image and applying a sepia tone.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @return SimpleImage</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> sepia(): static</div>
<div class="line">    {</div>
<div class="line">        imagefilter($this-&gt;image, IMG_FILTER_GRAYSCALE);</div>
<div class="line">        imagefilter($this-&gt;image, IMG_FILTER_COLORIZE, 70, 35, 0);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> $this;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Sharpens the image.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @param  int  $amount Sharpening amount (default 50).</span></div>
<div class="line"><span class="comment">     * @return SimpleImage</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> sharpen(<span class="keywordtype">int</span> $amount = 50): static</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Normalize amount</span></div>
<div class="line">        $amount = max(1, min(100, $amount)) / 100;</div>
<div class="line"> </div>
<div class="line">        $sharpen = [</div>
<div class="line">            [-1, -1, -1],</div>
<div class="line">            [-1,  8 / $amount, -1],</div>
<div class="line">            [-1, -1, -1],</div>
<div class="line">        ];</div>
<div class="line">        $divisor = array_sum(array_map(<span class="stringliteral">&#39;array_sum&#39;</span>, $sharpen));</div>
<div class="line"> </div>
<div class="line">        imageconvolution($this-&gt;image, $sharpen, $divisor, 0);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> $this;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Applies the mean remove filter to produce a sketch effect.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @return SimpleImage</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> sketch(): static</div>
<div class="line">    {</div>
<div class="line">        imagefilter($this-&gt;image, IMG_FILTER_MEAN_REMOVAL);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> $this;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    //////////////////////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment"></span>    <span class="comment">// Color utilities</span><span class="comment"></span></div>
<div class="line"><span class="comment">    //////////////////////////////////////////////////////////////////////////////////////////////////</span></div>
<div class="line"><span class="comment"></span><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Converts a &quot;friendly color&quot; into a color identifier for use with GD&#39;s image functions.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @param  string|array  $color The color to allocate.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @throws Exception</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">protected</span> <span class="keyword">function</span> allocateColor(<span class="keywordtype">string</span>|array $color): int</div>
<div class="line">    {</div>
<div class="line">        $color = self::normalizeColor($color);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Was this color already allocated?</span></div>
<div class="line">        $index = imagecolorexactalpha(</div>
<div class="line">            $this-&gt;image,</div>
<div class="line">            $color[<span class="stringliteral">&#39;red&#39;</span>],</div>
<div class="line">            $color[<span class="stringliteral">&#39;green&#39;</span>],</div>
<div class="line">            $color[<span class="stringliteral">&#39;blue&#39;</span>],</div>
<div class="line">            (<span class="keywordtype">int</span>) (127 - ($color[<span class="stringliteral">&#39;alpha&#39;</span>] * 127))</div>
<div class="line">        );</div>
<div class="line">        <span class="keywordflow">if</span> ($index &gt; -1) {</div>
<div class="line">            <span class="comment">// Yes, return this color index</span></div>
<div class="line">            <span class="keywordflow">return</span> $index;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Allocate a new color index</span></div>
<div class="line">        <span class="keywordflow">return</span> imagecolorallocatealpha(</div>
<div class="line">            $this-&gt;image,</div>
<div class="line">            $color[<span class="stringliteral">&#39;red&#39;</span>],</div>
<div class="line">            $color[<span class="stringliteral">&#39;green&#39;</span>],</div>
<div class="line">            $color[<span class="stringliteral">&#39;blue&#39;</span>],</div>
<div class="line">            127 - ($color[<span class="stringliteral">&#39;alpha&#39;</span>] * 127)</div>
<div class="line">        );</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Adjusts a color by increasing/decreasing red/green/blue/alpha values independently.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @param  string|array  $color The color to adjust.</span></div>
<div class="line"><span class="comment">     * @param  int  $red Red adjustment (-255 - 255).</span></div>
<div class="line"><span class="comment">     * @param  int  $green Green adjustment (-255 - 255).</span></div>
<div class="line"><span class="comment">     * @param  int  $blue Blue adjustment (-255 - 255).</span></div>
<div class="line"><span class="comment">     * @param  int  $alpha Alpha adjustment (-1 - 1).</span></div>
<div class="line"><span class="comment">     * @return int[] An RGBA color array.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @throws Exception</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">function</span> adjustColor(<span class="keywordtype">string</span>|array $color, <span class="keywordtype">int</span> $red, <span class="keywordtype">int</span> $green, <span class="keywordtype">int</span> $blue, <span class="keywordtype">int</span> $alpha): array</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Normalize to RGBA</span></div>
<div class="line">        $color = self::normalizeColor($color);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Adjust each channel</span></div>
<div class="line">        <span class="keywordflow">return</span> self::normalizeColor([</div>
<div class="line">            <span class="stringliteral">&#39;red&#39;</span> =&gt; $color[<span class="stringliteral">&#39;red&#39;</span>] + $red,</div>
<div class="line">            <span class="stringliteral">&#39;green&#39;</span> =&gt; $color[<span class="stringliteral">&#39;green&#39;</span>] + $green,</div>
<div class="line">            <span class="stringliteral">&#39;blue&#39;</span> =&gt; $color[<span class="stringliteral">&#39;blue&#39;</span>] + $blue,</div>
<div class="line">            <span class="stringliteral">&#39;alpha&#39;</span> =&gt; $color[<span class="stringliteral">&#39;alpha&#39;</span>] + $alpha,</div>
<div class="line">        ]);</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Darkens a color.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @param  string|array  $color The color to darken.</span></div>
<div class="line"><span class="comment">     * @param  int  $amount Amount to darken (0 - 255).</span></div>
<div class="line"><span class="comment">     * @return int[] An RGBA color array.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @throws Exception</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">function</span> darkenColor(<span class="keywordtype">string</span>|array $color, <span class="keywordtype">int</span> $amount): array</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> self::adjustColor($color, -$amount, -$amount, -$amount, 0);</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Extracts colors from an image like a human would do. This method requires the third-party</span></div>
<div class="line"><span class="comment">     * library \League\ColorExtractor. If you&#39;re using Composer, it will be installed for you</span></div>
<div class="line"><span class="comment">     * automatically.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @param  int  $count The max number of colors to extract (default 5).</span></div>
<div class="line"><span class="comment">     * @param  string|array|null  $backgroundColor</span></div>
<div class="line"><span class="comment">     *    By default any pixel with alpha value greater than zero will</span></div>
<div class="line"><span class="comment">     *    be discarded. This is because transparent colors are not perceived as is. For example, fully</span></div>
<div class="line"><span class="comment">     *    transparent black would be seen white on a white background. So if you want to take</span></div>
<div class="line"><span class="comment">     *    transparency into account, you have to specify a default background color.</span></div>
<div class="line"><span class="comment">     * @return int[] An array of RGBA colors arrays.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @throws Exception Thrown if library \League\ColorExtractor is missing.</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> extractColors(<span class="keywordtype">int</span> $count = 5, <span class="keywordtype">string</span>|array $backgroundColor = <span class="keyword">null</span>): array</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Check for required library</span></div>
<div class="line">        <span class="keywordflow">if</span> (! class_exists(<span class="charliteral">&#39;\\&#39;</span>.ColorExtractor::class)) {</div>
<div class="line">            <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(</div>
<div class="line">                <span class="stringliteral">&#39;Required library \League\ColorExtractor is missing.&#39;</span>,</div>
<div class="line">                self::ERR_LIB_NOT_LOADED</div>
<div class="line">            );</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Convert background color to an integer value</span></div>
<div class="line">        <span class="keywordflow">if</span> ($backgroundColor) {</div>
<div class="line">            $backgroundColor = self::normalizeColor($backgroundColor);</div>
<div class="line">            $backgroundColor = Color::fromRgbToInt([</div>
<div class="line">                <span class="charliteral">&#39;r&#39;</span> =&gt; $backgroundColor[<span class="stringliteral">&#39;red&#39;</span>],</div>
<div class="line">                <span class="charliteral">&#39;g&#39;</span> =&gt; $backgroundColor[<span class="stringliteral">&#39;green&#39;</span>],</div>
<div class="line">                <span class="charliteral">&#39;b&#39;</span> =&gt; $backgroundColor[<span class="stringliteral">&#39;blue&#39;</span>],</div>
<div class="line">            ]);</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Extract colors from the image</span></div>
<div class="line">        $palette = Palette::fromGD($this-&gt;image, $backgroundColor);</div>
<div class="line">        $extractor = <span class="keyword">new</span> ColorExtractor($palette);</div>
<div class="line">        $colors = $extractor-&gt;extract($count);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Convert colors to an RGBA color array</span></div>
<div class="line">        <span class="keywordflow">foreach</span> ($colors as $key =&gt; <a class="code" href="widget-edit_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a>) {</div>
<div class="line">            $colors[$key] = self::normalizeColor(Color::fromIntToHex(<a class="code" href="widget-edit_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a>));</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> $colors;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Gets the RGBA value of a single pixel.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @param  int  $x The horizontal position of the pixel.</span></div>
<div class="line"><span class="comment">     * @param  int  $y The vertical position of the pixel.</span></div>
<div class="line"><span class="comment">     * @return bool|int[] An RGBA color array or false if the x/y position is off the canvas.</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">function</span> getColorAt(<span class="keywordtype">int</span> $x, <span class="keywordtype">int</span> $y): array|bool</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Coordinates must be on the canvas</span></div>
<div class="line">        <span class="keywordflow">if</span> ($x &lt; 0 || $x &gt; $this-&gt;getWidth() || $y &lt; 0 || $y &gt; $this-&gt;getHeight()) {</div>
<div class="line">            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Get the color of this pixel and convert it to RGBA</span></div>
<div class="line">        $color = imagecolorat($this-&gt;image, $x, $y);</div>
<div class="line">        $rgba = imagecolorsforindex($this-&gt;image, $color);</div>
<div class="line">        $rgba[<span class="stringliteral">&#39;alpha&#39;</span>] = 127 - ($color &gt;&gt; 24) &amp; 0xFF;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> $rgba;</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Lightens a color.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @param  string|array  $color The color to lighten.</span></div>
<div class="line"><span class="comment">     * @param  int  $amount Amount to lighten (0 - 255).</span></div>
<div class="line"><span class="comment">     * @return int[] An RGBA color array.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @throws Exception</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">function</span> lightenColor(<span class="keywordtype">string</span>|array $color, <span class="keywordtype">int</span> $amount): array</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> self::adjustColor($color, $amount, $amount, $amount, 0);</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Normalizes a hex or array color value to a well-formatted RGBA array.</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @param  string|array  $color</span></div>
<div class="line"><span class="comment">     *    A CSS color name, hex string, or an array [red, green, blue, alpha].</span></div>
<div class="line"><span class="comment">     *    You can pipe alpha transparency through hex strings and color names. For example:</span></div>
<div class="line"><span class="comment">     *        #fff|0.50 &lt;-- 50% white</span></div>
<div class="line"><span class="comment">     *        red|0.25 &lt;-- 25% red</span></div>
<div class="line"><span class="comment">     * @return array [red, green, blue, alpha].</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     * @throws Exception Thrown if color value is invalid.</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">function</span> normalizeColor(<span class="keywordtype">string</span>|array $color): array</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// 140 CSS color names and hex values</span></div>
<div class="line">        $cssColors = [</div>
<div class="line">            <span class="stringliteral">&#39;aliceblue&#39;</span> =&gt; <span class="stringliteral">&#39;#f0f8ff&#39;</span>, <span class="stringliteral">&#39;antiquewhite&#39;</span> =&gt; <span class="stringliteral">&#39;#faebd7&#39;</span>, <span class="stringliteral">&#39;aqua&#39;</span> =&gt; <span class="stringliteral">&#39;#00ffff&#39;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;aquamarine&#39;</span> =&gt; <span class="stringliteral">&#39;#7fffd4&#39;</span>, <span class="stringliteral">&#39;azure&#39;</span> =&gt; <span class="stringliteral">&#39;#f0ffff&#39;</span>, <span class="stringliteral">&#39;beige&#39;</span> =&gt; <span class="stringliteral">&#39;#f5f5dc&#39;</span>, <span class="stringliteral">&#39;bisque&#39;</span> =&gt; <span class="stringliteral">&#39;#ffe4c4&#39;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;black&#39;</span> =&gt; <span class="stringliteral">&#39;#000000&#39;</span>, <span class="stringliteral">&#39;blanchedalmond&#39;</span> =&gt; <span class="stringliteral">&#39;#ffebcd&#39;</span>, <span class="stringliteral">&#39;blue&#39;</span> =&gt; <span class="stringliteral">&#39;#0000ff&#39;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;blueviolet&#39;</span> =&gt; <span class="stringliteral">&#39;#8a2be2&#39;</span>, <span class="stringliteral">&#39;brown&#39;</span> =&gt; <span class="stringliteral">&#39;#a52a2a&#39;</span>, <span class="stringliteral">&#39;burlywood&#39;</span> =&gt; <span class="stringliteral">&#39;#deb887&#39;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;cadetblue&#39;</span> =&gt; <span class="stringliteral">&#39;#5f9ea0&#39;</span>, <span class="stringliteral">&#39;chartreuse&#39;</span> =&gt; <span class="stringliteral">&#39;#7fff00&#39;</span>, <span class="stringliteral">&#39;chocolate&#39;</span> =&gt; <span class="stringliteral">&#39;#d2691e&#39;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;coral&#39;</span> =&gt; <span class="stringliteral">&#39;#ff7f50&#39;</span>, <span class="stringliteral">&#39;cornflowerblue&#39;</span> =&gt; <span class="stringliteral">&#39;#6495ed&#39;</span>, <span class="stringliteral">&#39;cornsilk&#39;</span> =&gt; <span class="stringliteral">&#39;#fff8dc&#39;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;crimson&#39;</span> =&gt; <span class="stringliteral">&#39;#dc143c&#39;</span>, <span class="stringliteral">&#39;cyan&#39;</span> =&gt; <span class="stringliteral">&#39;#00ffff&#39;</span>, <span class="stringliteral">&#39;darkblue&#39;</span> =&gt; <span class="stringliteral">&#39;#00008b&#39;</span>, <span class="stringliteral">&#39;darkcyan&#39;</span> =&gt; <span class="stringliteral">&#39;#008b8b&#39;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;darkgoldenrod&#39;</span> =&gt; <span class="stringliteral">&#39;#b8860b&#39;</span>, <span class="stringliteral">&#39;darkgray&#39;</span> =&gt; <span class="stringliteral">&#39;#a9a9a9&#39;</span>, <span class="stringliteral">&#39;darkgrey&#39;</span> =&gt; <span class="stringliteral">&#39;#a9a9a9&#39;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;darkgreen&#39;</span> =&gt; <span class="stringliteral">&#39;#006400&#39;</span>, <span class="stringliteral">&#39;darkkhaki&#39;</span> =&gt; <span class="stringliteral">&#39;#bdb76b&#39;</span>, <span class="stringliteral">&#39;darkmagenta&#39;</span> =&gt; <span class="stringliteral">&#39;#8b008b&#39;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;darkolivegreen&#39;</span> =&gt; <span class="stringliteral">&#39;#556b2f&#39;</span>, <span class="stringliteral">&#39;darkorange&#39;</span> =&gt; <span class="stringliteral">&#39;#ff8c00&#39;</span>, <span class="stringliteral">&#39;darkorchid&#39;</span> =&gt; <span class="stringliteral">&#39;#9932cc&#39;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;darkred&#39;</span> =&gt; <span class="stringliteral">&#39;#8b0000&#39;</span>, <span class="stringliteral">&#39;darksalmon&#39;</span> =&gt; <span class="stringliteral">&#39;#e9967a&#39;</span>, <span class="stringliteral">&#39;darkseagreen&#39;</span> =&gt; <span class="stringliteral">&#39;#8fbc8f&#39;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;darkslateblue&#39;</span> =&gt; <span class="stringliteral">&#39;#483d8b&#39;</span>, <span class="stringliteral">&#39;darkslategray&#39;</span> =&gt; <span class="stringliteral">&#39;#2f4f4f&#39;</span>, <span class="stringliteral">&#39;darkslategrey&#39;</span> =&gt; <span class="stringliteral">&#39;#2f4f4f&#39;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;darkturquoise&#39;</span> =&gt; <span class="stringliteral">&#39;#00ced1&#39;</span>, <span class="stringliteral">&#39;darkviolet&#39;</span> =&gt; <span class="stringliteral">&#39;#9400d3&#39;</span>, <span class="stringliteral">&#39;deeppink&#39;</span> =&gt; <span class="stringliteral">&#39;#ff1493&#39;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;deepskyblue&#39;</span> =&gt; <span class="stringliteral">&#39;#00bfff&#39;</span>, <span class="stringliteral">&#39;dimgray&#39;</span> =&gt; <span class="stringliteral">&#39;#696969&#39;</span>, <span class="stringliteral">&#39;dimgrey&#39;</span> =&gt; <span class="stringliteral">&#39;#696969&#39;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;dodgerblue&#39;</span> =&gt; <span class="stringliteral">&#39;#1e90ff&#39;</span>, <span class="stringliteral">&#39;firebrick&#39;</span> =&gt; <span class="stringliteral">&#39;#b22222&#39;</span>, <span class="stringliteral">&#39;floralwhite&#39;</span> =&gt; <span class="stringliteral">&#39;#fffaf0&#39;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;forestgreen&#39;</span> =&gt; <span class="stringliteral">&#39;#228b22&#39;</span>, <span class="stringliteral">&#39;fuchsia&#39;</span> =&gt; <span class="stringliteral">&#39;#ff00ff&#39;</span>, <span class="stringliteral">&#39;gainsboro&#39;</span> =&gt; <span class="stringliteral">&#39;#dcdcdc&#39;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;ghostwhite&#39;</span> =&gt; <span class="stringliteral">&#39;#f8f8ff&#39;</span>, <span class="stringliteral">&#39;gold&#39;</span> =&gt; <span class="stringliteral">&#39;#ffd700&#39;</span>, <span class="stringliteral">&#39;goldenrod&#39;</span> =&gt; <span class="stringliteral">&#39;#daa520&#39;</span>, <span class="stringliteral">&#39;gray&#39;</span> =&gt; <span class="stringliteral">&#39;#808080&#39;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;grey&#39;</span> =&gt; <span class="stringliteral">&#39;#808080&#39;</span>, <span class="stringliteral">&#39;green&#39;</span> =&gt; <span class="stringliteral">&#39;#008000&#39;</span>, <span class="stringliteral">&#39;greenyellow&#39;</span> =&gt; <span class="stringliteral">&#39;#adff2f&#39;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;honeydew&#39;</span> =&gt; <span class="stringliteral">&#39;#f0fff0&#39;</span>, <span class="stringliteral">&#39;hotpink&#39;</span> =&gt; <span class="stringliteral">&#39;#ff69b4&#39;</span>, <span class="stringliteral">&#39;indianred &#39;</span> =&gt; <span class="stringliteral">&#39;#cd5c5c&#39;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;indigo &#39;</span> =&gt; <span class="stringliteral">&#39;#4b0082&#39;</span>, <span class="stringliteral">&#39;ivory&#39;</span> =&gt; <span class="stringliteral">&#39;#fffff0&#39;</span>, <span class="stringliteral">&#39;khaki&#39;</span> =&gt; <span class="stringliteral">&#39;#f0e68c&#39;</span>, <span class="stringliteral">&#39;lavender&#39;</span> =&gt; <span class="stringliteral">&#39;#e6e6fa&#39;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;lavenderblush&#39;</span> =&gt; <span class="stringliteral">&#39;#fff0f5&#39;</span>, <span class="stringliteral">&#39;lawngreen&#39;</span> =&gt; <span class="stringliteral">&#39;#7cfc00&#39;</span>, <span class="stringliteral">&#39;lemonchiffon&#39;</span> =&gt; <span class="stringliteral">&#39;#fffacd&#39;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;lightblue&#39;</span> =&gt; <span class="stringliteral">&#39;#add8e6&#39;</span>, <span class="stringliteral">&#39;lightcoral&#39;</span> =&gt; <span class="stringliteral">&#39;#f08080&#39;</span>, <span class="stringliteral">&#39;lightcyan&#39;</span> =&gt; <span class="stringliteral">&#39;#e0ffff&#39;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;lightgoldenrodyellow&#39;</span> =&gt; <span class="stringliteral">&#39;#fafad2&#39;</span>, <span class="stringliteral">&#39;lightgray&#39;</span> =&gt; <span class="stringliteral">&#39;#d3d3d3&#39;</span>, <span class="stringliteral">&#39;lightgrey&#39;</span> =&gt; <span class="stringliteral">&#39;#d3d3d3&#39;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;lightgreen&#39;</span> =&gt; <span class="stringliteral">&#39;#90ee90&#39;</span>, <span class="stringliteral">&#39;lightpink&#39;</span> =&gt; <span class="stringliteral">&#39;#ffb6c1&#39;</span>, <span class="stringliteral">&#39;lightsalmon&#39;</span> =&gt; <span class="stringliteral">&#39;#ffa07a&#39;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;lightseagreen&#39;</span> =&gt; <span class="stringliteral">&#39;#20b2aa&#39;</span>, <span class="stringliteral">&#39;lightskyblue&#39;</span> =&gt; <span class="stringliteral">&#39;#87cefa&#39;</span>, <span class="stringliteral">&#39;lightslategray&#39;</span> =&gt; <span class="stringliteral">&#39;#778899&#39;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;lightslategrey&#39;</span> =&gt; <span class="stringliteral">&#39;#778899&#39;</span>, <span class="stringliteral">&#39;lightsteelblue&#39;</span> =&gt; <span class="stringliteral">&#39;#b0c4de&#39;</span>, <span class="stringliteral">&#39;lightyellow&#39;</span> =&gt; <span class="stringliteral">&#39;#ffffe0&#39;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;lime&#39;</span> =&gt; <span class="stringliteral">&#39;#00ff00&#39;</span>, <span class="stringliteral">&#39;limegreen&#39;</span> =&gt; <span class="stringliteral">&#39;#32cd32&#39;</span>, <span class="stringliteral">&#39;linen&#39;</span> =&gt; <span class="stringliteral">&#39;#faf0e6&#39;</span>, <span class="stringliteral">&#39;magenta&#39;</span> =&gt; <span class="stringliteral">&#39;#ff00ff&#39;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;maroon&#39;</span> =&gt; <span class="stringliteral">&#39;#800000&#39;</span>, <span class="stringliteral">&#39;mediumaquamarine&#39;</span> =&gt; <span class="stringliteral">&#39;#66cdaa&#39;</span>, <span class="stringliteral">&#39;mediumblue&#39;</span> =&gt; <span class="stringliteral">&#39;#0000cd&#39;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;mediumorchid&#39;</span> =&gt; <span class="stringliteral">&#39;#ba55d3&#39;</span>, <span class="stringliteral">&#39;mediumpurple&#39;</span> =&gt; <span class="stringliteral">&#39;#9370db&#39;</span>, <span class="stringliteral">&#39;mediumseagreen&#39;</span> =&gt; <span class="stringliteral">&#39;#3cb371&#39;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;mediumslateblue&#39;</span> =&gt; <span class="stringliteral">&#39;#7b68ee&#39;</span>, <span class="stringliteral">&#39;mediumspringgreen&#39;</span> =&gt; <span class="stringliteral">&#39;#00fa9a&#39;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;mediumturquoise&#39;</span> =&gt; <span class="stringliteral">&#39;#48d1cc&#39;</span>, <span class="stringliteral">&#39;mediumvioletred&#39;</span> =&gt; <span class="stringliteral">&#39;#c71585&#39;</span>, <span class="stringliteral">&#39;midnightblue&#39;</span> =&gt; <span class="stringliteral">&#39;#191970&#39;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;mintcream&#39;</span> =&gt; <span class="stringliteral">&#39;#f5fffa&#39;</span>, <span class="stringliteral">&#39;mistyrose&#39;</span> =&gt; <span class="stringliteral">&#39;#ffe4e1&#39;</span>, <span class="stringliteral">&#39;moccasin&#39;</span> =&gt; <span class="stringliteral">&#39;#ffe4b5&#39;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;navajowhite&#39;</span> =&gt; <span class="stringliteral">&#39;#ffdead&#39;</span>, <span class="stringliteral">&#39;navy&#39;</span> =&gt; <span class="stringliteral">&#39;#000080&#39;</span>, <span class="stringliteral">&#39;oldlace&#39;</span> =&gt; <span class="stringliteral">&#39;#fdf5e6&#39;</span>, <span class="stringliteral">&#39;olive&#39;</span> =&gt; <span class="stringliteral">&#39;#808000&#39;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;olivedrab&#39;</span> =&gt; <span class="stringliteral">&#39;#6b8e23&#39;</span>, <span class="stringliteral">&#39;orange&#39;</span> =&gt; <span class="stringliteral">&#39;#ffa500&#39;</span>, <span class="stringliteral">&#39;orangered&#39;</span> =&gt; <span class="stringliteral">&#39;#ff4500&#39;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;orchid&#39;</span> =&gt; <span class="stringliteral">&#39;#da70d6&#39;</span>, <span class="stringliteral">&#39;palegoldenrod&#39;</span> =&gt; <span class="stringliteral">&#39;#eee8aa&#39;</span>, <span class="stringliteral">&#39;palegreen&#39;</span> =&gt; <span class="stringliteral">&#39;#98fb98&#39;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;paleturquoise&#39;</span> =&gt; <span class="stringliteral">&#39;#afeeee&#39;</span>, <span class="stringliteral">&#39;palevioletred&#39;</span> =&gt; <span class="stringliteral">&#39;#db7093&#39;</span>, <span class="stringliteral">&#39;papayawhip&#39;</span> =&gt; <span class="stringliteral">&#39;#ffefd5&#39;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;peachpuff&#39;</span> =&gt; <span class="stringliteral">&#39;#ffdab9&#39;</span>, <span class="stringliteral">&#39;peru&#39;</span> =&gt; <span class="stringliteral">&#39;#cd853f&#39;</span>, <span class="stringliteral">&#39;pink&#39;</span> =&gt; <span class="stringliteral">&#39;#ffc0cb&#39;</span>, <span class="stringliteral">&#39;plum&#39;</span> =&gt; <span class="stringliteral">&#39;#dda0dd&#39;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;powderblue&#39;</span> =&gt; <span class="stringliteral">&#39;#b0e0e6&#39;</span>, <span class="stringliteral">&#39;purple&#39;</span> =&gt; <span class="stringliteral">&#39;#800080&#39;</span>, <span class="stringliteral">&#39;rebeccapurple&#39;</span> =&gt; <span class="stringliteral">&#39;#663399&#39;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;red&#39;</span> =&gt; <span class="stringliteral">&#39;#ff0000&#39;</span>, <span class="stringliteral">&#39;rosybrown&#39;</span> =&gt; <span class="stringliteral">&#39;#bc8f8f&#39;</span>, <span class="stringliteral">&#39;royalblue&#39;</span> =&gt; <span class="stringliteral">&#39;#4169e1&#39;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;saddlebrown&#39;</span> =&gt; <span class="stringliteral">&#39;#8b4513&#39;</span>, <span class="stringliteral">&#39;salmon&#39;</span> =&gt; <span class="stringliteral">&#39;#fa8072&#39;</span>, <span class="stringliteral">&#39;sandybrown&#39;</span> =&gt; <span class="stringliteral">&#39;#f4a460&#39;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;seagreen&#39;</span> =&gt; <span class="stringliteral">&#39;#2e8b57&#39;</span>, <span class="stringliteral">&#39;seashell&#39;</span> =&gt; <span class="stringliteral">&#39;#fff5ee&#39;</span>, <span class="stringliteral">&#39;sienna&#39;</span> =&gt; <span class="stringliteral">&#39;#a0522d&#39;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;silver&#39;</span> =&gt; <span class="stringliteral">&#39;#c0c0c0&#39;</span>, <span class="stringliteral">&#39;skyblue&#39;</span> =&gt; <span class="stringliteral">&#39;#87ceeb&#39;</span>, <span class="stringliteral">&#39;slateblue&#39;</span> =&gt; <span class="stringliteral">&#39;#6a5acd&#39;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;slategray&#39;</span> =&gt; <span class="stringliteral">&#39;#708090&#39;</span>, <span class="stringliteral">&#39;slategrey&#39;</span> =&gt; <span class="stringliteral">&#39;#708090&#39;</span>, <span class="stringliteral">&#39;snow&#39;</span> =&gt; <span class="stringliteral">&#39;#fffafa&#39;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;springgreen&#39;</span> =&gt; <span class="stringliteral">&#39;#00ff7f&#39;</span>, <span class="stringliteral">&#39;steelblue&#39;</span> =&gt; <span class="stringliteral">&#39;#4682b4&#39;</span>, <span class="stringliteral">&#39;tan&#39;</span> =&gt; <span class="stringliteral">&#39;#d2b48c&#39;</span>, <span class="stringliteral">&#39;teal&#39;</span> =&gt; <span class="stringliteral">&#39;#008080&#39;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;thistle&#39;</span> =&gt; <span class="stringliteral">&#39;#d8bfd8&#39;</span>, <span class="stringliteral">&#39;tomato&#39;</span> =&gt; <span class="stringliteral">&#39;#ff6347&#39;</span>, <span class="stringliteral">&#39;turquoise&#39;</span> =&gt; <span class="stringliteral">&#39;#40e0d0&#39;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;violet&#39;</span> =&gt; <span class="stringliteral">&#39;#ee82ee&#39;</span>, <span class="stringliteral">&#39;wheat&#39;</span> =&gt; <span class="stringliteral">&#39;#f5deb3&#39;</span>, <span class="stringliteral">&#39;white&#39;</span> =&gt; <span class="stringliteral">&#39;#ffffff&#39;</span>, <span class="stringliteral">&#39;whitesmoke&#39;</span> =&gt; <span class="stringliteral">&#39;#f5f5f5&#39;</span>,</div>
<div class="line">            <span class="stringliteral">&#39;yellow&#39;</span> =&gt; <span class="stringliteral">&#39;#ffff00&#39;</span>, <span class="stringliteral">&#39;yellowgreen&#39;</span> =&gt; <span class="stringliteral">&#39;#9acd32&#39;</span>,</div>
<div class="line">        ];</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Parse alpha from &#39;#fff|.5&#39; and &#39;white|.5&#39;</span></div>
<div class="line">        <span class="keywordflow">if</span> (is_string($color) &amp;&amp; strstr($color, <span class="charliteral">&#39;|&#39;</span>)) {</div>
<div class="line">            $color = explode(<span class="charliteral">&#39;|&#39;</span>, $color);</div>
<div class="line">            $alpha = (float) $color[1];</div>
<div class="line">            $color = trim($color[0]);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            $alpha = 1;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Translate CSS color names to hex values</span></div>
<div class="line">        <span class="keywordflow">if</span> (is_string($color) &amp;&amp; array_key_exists(strtolower($color), $cssColors)) {</div>
<div class="line">            $color = $cssColors[strtolower($color)];</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Translate transparent keyword to a transparent color</span></div>
<div class="line">        <span class="keywordflow">if</span> ($color === <span class="stringliteral">&#39;transparent&#39;</span>) {</div>
<div class="line">            $color = [<span class="stringliteral">&#39;red&#39;</span> =&gt; 0, <span class="stringliteral">&#39;green&#39;</span> =&gt; 0, <span class="stringliteral">&#39;blue&#39;</span> =&gt; 0, <span class="stringliteral">&#39;alpha&#39;</span> =&gt; 0];</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Convert hex values to RGBA</span></div>
<div class="line">        <span class="keywordflow">if</span> (is_string($color)) {</div>
<div class="line">            <span class="comment">// Remove #</span></div>
<div class="line">            $hex = strval(preg_replace(<span class="stringliteral">&#39;/^#/&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $color));</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Support short and standard hex codes</span></div>
<div class="line">            <span class="keywordflow">if</span> (strlen($hex) === 3) {</div>
<div class="line">                [$red, $green, $blue] = [</div>
<div class="line">                    $hex[0].$hex[0],</div>
<div class="line">                    $hex[1].$hex[1],</div>
<div class="line">                    $hex[2].$hex[2],</div>
<div class="line">                ];</div>
<div class="line">            } elseif (strlen($hex) === 6) {</div>
<div class="line">                [$red, $green, $blue] = [</div>
<div class="line">                    $hex[0].$hex[1],</div>
<div class="line">                    $hex[2].$hex[3],</div>
<div class="line">                    $hex[4].$hex[5],</div>
<div class="line">                ];</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;Invalid color value: $color&quot;</span>, self::ERR_INVALID_COLOR);</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Turn color into an array</span></div>
<div class="line">            $color = [</div>
<div class="line">                <span class="stringliteral">&#39;red&#39;</span> =&gt; hexdec($red),</div>
<div class="line">                <span class="stringliteral">&#39;green&#39;</span> =&gt; hexdec($green),</div>
<div class="line">                <span class="stringliteral">&#39;blue&#39;</span> =&gt; hexdec($blue),</div>
<div class="line">                <span class="stringliteral">&#39;alpha&#39;</span> =&gt; $alpha,</div>
<div class="line">            ];</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Enforce color value ranges</span></div>
<div class="line">        <span class="keywordflow">if</span> (is_array($color)) {</div>
<div class="line">            <span class="comment">// RGB default to 0</span></div>
<div class="line">            $color[<span class="stringliteral">&#39;red&#39;</span>] ??= 0;</div>
<div class="line">            $color[<span class="stringliteral">&#39;green&#39;</span>] ??= 0;</div>
<div class="line">            $color[<span class="stringliteral">&#39;blue&#39;</span>] ??= 0;</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Alpha defaults to 1</span></div>
<div class="line">            $color[<span class="stringliteral">&#39;alpha&#39;</span>] ??= 1;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">return</span> [</div>
<div class="line">                <span class="stringliteral">&#39;red&#39;</span> =&gt; (int) self::keepWithin((<span class="keywordtype">int</span>) $color[<span class="stringliteral">&#39;red&#39;</span>], 0, 255),</div>
<div class="line">                <span class="stringliteral">&#39;green&#39;</span> =&gt; (<span class="keywordtype">int</span>) self::keepWithin((<span class="keywordtype">int</span>) $color[<span class="stringliteral">&#39;green&#39;</span>], 0, 255),</div>
<div class="line">                <span class="stringliteral">&#39;blue&#39;</span> =&gt; (int) self::keepWithin((<span class="keywordtype">int</span>) $color[<span class="stringliteral">&#39;blue&#39;</span>], 0, 255),</div>
<div class="line">                <span class="stringliteral">&#39;alpha&#39;</span> =&gt; self::keepWithin($color[<span class="stringliteral">&#39;alpha&#39;</span>], 0, 1),</div>
<div class="line">            ];</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;Invalid color value: $color&quot;</span>, self::ERR_INVALID_COLOR);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="aactions_8php_html_a0722441477f957078ee2437054556cbc"><div class="ttname"><a href="actions_8php.html#a0722441477f957078ee2437054556cbc">$filename</a></div><div class="ttdeci">$filename</div><div class="ttdef"><b>Definition:</b> <a href="actions_8php_source.html#l00010">actions.php:10</a></div></div>
<div class="ttc" id="aadmin_2includes_2stats_8php_html_a6efc15b5a2314dd4b5aaa556a375c6d6"><div class="ttname"><a href="admin_2includes_2stats_8php.html#a6efc15b5a2314dd4b5aaa556a375c6d6">$data</a></div><div class="ttdeci">$data</div><div class="ttdef"><b>Definition:</b> <a href="admin_2includes_2stats_8php_source.html#l00078">stats.php:78</a></div></div>
<div class="ttc" id="ablog-edit_8php_html_afe81f9052fdaa7785564b7439d898650"><div class="ttname"><a href="blog-edit_8php.html#afe81f9052fdaa7785564b7439d898650">thumbnail</a></div><div class="ttdeci">print $blog thumbnail</div><div class="ttdef"><b>Definition:</b> <a href="blog-edit_8php_source.html#l00583">blog-edit.php:583</a></div></div>
<div class="ttc" id="amessage-fetch_8php_html_a9a4a6fba2208984cabb3afacadf33919"><div class="ttname"><a href="message-fetch_8php.html#a9a4a6fba2208984cabb3afacadf33919">$type</a></div><div class="ttdeci">$type</div><div class="ttdef"><b>Definition:</b> <a href="message-fetch_8php_source.html#l00015">message-fetch.php:15</a></div></div>
<div class="ttc" id="anamespaceYAWK_html"><div class="ttname"><a href="namespaceYAWK.html">YAWK</a></div><div class="ttdoc">This class serves methods to create backup from files.</div><div class="ttdef"><b>Definition:</b> <a href="AdminLTE_8php_source.html#l00002">AdminLTE.php:2</a></div></div>
<div class="ttc" id="awebmail-deleteMessage_8php_html_a011800c63ece4cbbfa77136a20607023"><div class="ttname"><a href="webmail-deleteMessage_8php.html#a011800c63ece4cbbfa77136a20607023">$options</a></div><div class="ttdeci">$options</div><div class="ttdef"><b>Definition:</b> <a href="webmail-deleteMessage_8php_source.html#l00038">webmail-deleteMessage.php:38</a></div></div>
<div class="ttc" id="awidget-edit_8php_html_a0f298096f322952a72a50f98a74c7b60"><div class="ttname"><a href="widget-edit_8php.html#a0f298096f322952a72a50f98a74c7b60">$value</a></div><div class="ttdeci">$value</div><div class="ttdef"><b>Definition:</b> <a href="widget-edit_8php_source.html#l00244">widget-edit.php:244</a></div></div>
<div class="ttc" id="awidget-edit_8php_html_a83018d9153d17d91fbcf3bc10158d34f"><div class="ttname"><a href="widget-edit_8php.html#a83018d9153d17d91fbcf3bc10158d34f">$i</a></div><div class="ttdeci">$i</div><div class="ttdef"><b>Definition:</b> <a href="widget-edit_8php_source.html#l00203">widget-edit.php:203</a></div></div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Jan 16 2024 15:10:06 for YaWK by <small>doxygen 1.9.1</small></li>
  </ul>
</div>
</body>
</html>
